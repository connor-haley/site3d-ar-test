"use strict";var Kt=Object.defineProperty;var Jt=(e,t,n)=>t in e?Kt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var g=(e,t,n)=>Jt(e,typeof t!="symbol"?t+"":t,n);const Y0=require("postprocessing"),c=require("three"),y=require("@takram/three-geospatial"),Qt=["solarIrradiance","sunAngularRadius","bottomRadius","topRadius","rayleighScattering","mieScattering","miePhaseFunctionG","muSMinFloat","muSMinHalfFloat","skyRadianceToLuminance","sunRadianceToLuminance","luminousEfficiency"];function tn(e,t){if(t!=null)for(const n of Qt){const r=t[n];r!=null&&(e[n]instanceof c.Vector3?e[n].copy(r):(y.assertType(n),e[n]=r))}}const P0=class P0{constructor(t){g(this,"solarIrradiance",new c.Vector3(1.474,1.8504,1.91198));g(this,"sunAngularRadius",.004675);g(this,"bottomRadius",636e4);g(this,"topRadius",642e4);g(this,"rayleighScattering",new c.Vector3(.005802,.013558,.0331));g(this,"mieScattering",new c.Vector3(.003996,.003996,.003996));g(this,"miePhaseFunctionG",.8);g(this,"muSMinFloat",Math.cos(y.radians(120)));g(this,"muSMinHalfFloat",Math.cos(y.radians(102)));g(this,"skyRadianceToLuminance",new c.Vector3(114974.916437,71305.954816,65310.548555));g(this,"sunRadianceToLuminance",new c.Vector3(98242.786222,69954.398112,66475.012354));g(this,"luminousEfficiency",new c.Vector3(.2126,.7152,.0722));g(this,"skyRadianceToRelativeLuminance",new c.Vector3);g(this,"sunRadianceToRelativeLuminance",new c.Vector3);tn(this,t);const n=this.luminousEfficiency.dot(this.skyRadianceToLuminance);this.skyRadianceToRelativeLuminance.copy(this.skyRadianceToLuminance).divideScalar(n),this.sunRadianceToRelativeLuminance.copy(this.sunRadianceToLuminance).divideScalar(n)}};g(P0,"DEFAULT",new P0);let X=P0;const d0=64,_0=16,U0=32,G0=128,O0=32,b0=8,Mt=b0*O0,yt=G0,It=U0,m0=256,f0=64,j=1/1e3,nn=100;var en=`uniform sampler2D normalBuffer;

uniform mat4 projectionMatrix;
uniform mat4 inverseProjectionMatrix;
uniform mat4 inverseViewMatrix;
uniform float cameraHeight;
uniform vec3 sunDirection;
uniform vec3 moonDirection;
uniform float moonAngularRadius;
uniform float lunarRadianceScale;
uniform float irradianceScale;
uniform float idealSphereAlpha;

varying vec3 vWorldPosition;
varying vec3 vWorldDirection;
varying vec3 vEllipsoidCenter;
varying vec3 vSkyEllipsoidCenter;
varying vec3 vEllipsoidRadiiSquared;

vec3 readNormal(const vec2 uv) {
  #ifdef OCT_ENCODED_NORMAL
  return unpackVec2ToNormal(texture2D(normalBuffer, uv).xy);
  #else
  return 2.0 * texture2D(normalBuffer, uv).xyz - 1.0;
  #endif 
}

void correctGeometricError(inout vec3 worldPosition, inout vec3 worldNormal) {
  
  vec3 normal = normalize(1.0 / vEllipsoidRadiiSquared * worldPosition);
  vec3 position = u_bottom_radius * normal;
  worldNormal = mix(worldNormal, normal, idealSphereAlpha);
  worldPosition = mix(worldPosition, position, idealSphereAlpha);
}

#if defined(SUN_IRRADIANCE) || defined(SKY_IRRADIANCE)
vec3 getSunSkyIrradiance(
  const vec3 worldPosition,
  const vec3 worldNormal,
  const vec3 inputColor
) {
  
  
  vec3 albedo = inputColor * irradianceScale * RECIPROCAL_PI;
  vec3 skyIrradiance;
  vec3 sunIrradiance = GetSunAndSkyIrradiance(
    worldPosition - vEllipsoidCenter,
    worldNormal,
    sunDirection,
    skyIrradiance
  );
  #if defined(SUN_IRRADIANCE) && defined(SKY_IRRADIANCE)
  return albedo * (sunIrradiance + skyIrradiance);
  #elif defined(SUN_IRRADIANCE)
  return albedo * sunIrradiance;
  #elif defined(SKY_IRRADIANCE)
  return albedo * skyIrradiance;
  #endif
}
#endif 

#if defined(TRANSMITTANCE) || defined(INSCATTER)
void getTransmittanceInscatter(
  const vec3 worldPosition,
  const vec3 worldNormal,
  inout vec3 radiance
) {
  vec3 transmittance;
  vec3 inscatter = GetSkyRadianceToPoint(
    vWorldPosition - vEllipsoidCenter,
    worldPosition - vEllipsoidCenter,
    0.0, 
    sunDirection,
    transmittance
  );
  #if defined(TRANSMITTANCE)
  radiance = radiance * transmittance;
  #endif
  #if defined(INSCATTER)
  radiance = radiance + inscatter;
  #endif
}
#endif 

void mainImage(const vec4 inputColor, const vec2 uv, out vec4 outputColor) {
  float depth = readDepth(uv);
  if (depth >= 1.0 - 1e-7) {
    #ifdef SKY
    vec3 viewPosition = vWorldPosition - vSkyEllipsoidCenter;
    vec3 rayDirection = normalize(vWorldDirection);
    outputColor.rgb = getSkyRadiance(
      viewPosition,
      rayDirection,
      sunDirection,
      moonDirection,
      moonAngularRadius,
      lunarRadianceScale
    );
    outputColor.a = 1.0;
    #else
    outputColor = inputColor;
    #endif 
    return;
  }
  depth = reverseLogDepth(depth, cameraNear, cameraFar);

  
  vec3 viewPosition = screenToView(
    uv,
    depth,
    getViewZ(depth),
    projectionMatrix,
    inverseProjectionMatrix
  );
  vec3 viewNormal;
  #ifdef RECONSTRUCT_NORMAL
  vec3 dx = dFdx(viewPosition);
  vec3 dy = dFdy(viewPosition);
  viewNormal = normalize(cross(dx, dy));
  #else
  viewNormal = readNormal(uv);
  #endif 

  vec3 worldPosition =
    (inverseViewMatrix * vec4(viewPosition, 1.0)).xyz * METER_TO_UNIT_LENGTH;
  vec3 worldNormal = normalize(mat3(inverseViewMatrix) * viewNormal);

  #ifdef CORRECT_GEOMETRIC_ERROR
  correctGeometricError(worldPosition, worldNormal);
  #endif 

  vec3 radiance;
  #if defined(SUN_IRRADIANCE) || defined(SKY_IRRADIANCE)
  radiance = getSunSkyIrradiance(worldPosition, worldNormal, inputColor.rgb);
  #else
  radiance = inputColor.rgb;
  #endif 

  #if defined(TRANSMITTANCE) || defined(INSCATTER)
  getTransmittanceInscatter(worldPosition, worldNormal, radiance);
  #endif 

  outputColor = vec4(radiance, inputColor.a);
}`,rn=`uniform mat4 inverseViewMatrix;
uniform mat4 inverseProjectionMatrix;
uniform vec3 cameraPosition;
uniform float cameraHeight;
uniform vec3 ellipsoidCenter;
uniform vec3 ellipsoidRadii;
uniform float idealSphereAlpha;

varying vec3 vWorldPosition;
varying vec3 vWorldDirection;
varying vec3 vEllipsoidCenter;
varying vec3 vSkyEllipsoidCenter;
varying vec3 vEllipsoidRadiiSquared;

void getCameraRay(out vec3 origin, out vec3 direction) {
  bool isPerspective = inverseProjectionMatrix[2][3] != 0.0; 

  if (isPerspective) {
    
    vec4 viewPosition = inverseProjectionMatrix * vec4(position, 1.0);
    vec4 worldDirection = inverseViewMatrix * vec4(viewPosition.xyz, 0.0);
    origin = cameraPosition;
    direction = worldDirection.xyz;
  } else {
    
    vec4 nearPoint = inverseProjectionMatrix * vec4(position.xy, -1.0, 1.0);
    vec4 farPoint = inverseProjectionMatrix * vec4(position.xy, -0.9, 1.0);
    nearPoint /= nearPoint.w;
    farPoint /= farPoint.w;

    
    vec4 worldDirection =
      inverseViewMatrix * vec4(farPoint.xyz - nearPoint.xyz, 0.0);
    vec4 worldOrigin = inverseViewMatrix * nearPoint;

    
    direction = worldDirection.xyz;
    origin = worldOrigin.xyz;
  }
}

void mainSupport() {
  vec3 direction, origin;
  getCameraRay(origin, direction);
  vWorldPosition = origin * METER_TO_UNIT_LENGTH;
  vWorldDirection = direction;

  vSkyEllipsoidCenter = ellipsoidCenter * METER_TO_UNIT_LENGTH;
  #ifdef CORRECT_GEOMETRIC_ERROR
  
  
  
  vEllipsoidCenter =
    mix(ellipsoidCenter, vec3(0.0), idealSphereAlpha) * METER_TO_UNIT_LENGTH;
  #else
  vEllipsoidCenter = vSkyEllipsoidCenter;
  #endif 

  vec3 radii = ellipsoidRadii * METER_TO_UNIT_LENGTH;
  vEllipsoidRadiiSquared = radii * radii;
}`,ut=`float ClampCosine(float mu) {
  return clamp(mu, float(-1.0), float(1.0));
}

float ClampDistance(float d) {
  return max(d, 0.0);
}

float ClampRadius(float r) {
  return clamp(r, u_bottom_radius, u_top_radius);
}

float SafeSqrt(float a) {
  return sqrt(max(a, 0.0));
}

float DistanceToTopAtmosphereBoundary(float r, float mu) {
  float discriminant = r * r * (mu * mu - 1.0) + u_top_radius * u_top_radius;
  return ClampDistance(-r * mu + SafeSqrt(discriminant));
}

float DistanceToBottomAtmosphereBoundary(float r, float mu) {
  float discriminant =
    r * r * (mu * mu - 1.0) + u_bottom_radius * u_bottom_radius;
  return ClampDistance(-r * mu - SafeSqrt(discriminant));
}

bool RayIntersectsGround(float r, float mu) {
  return mu < 0.0 &&
  r * r * (mu * mu - 1.0) + u_bottom_radius * u_bottom_radius >= 0.0;
}

float GetTextureCoordFromUnitRange(float x, int texture_size) {
  return 0.5 / float(texture_size) + x * (1.0 - 1.0 / float(texture_size));
}

float GetUnitRangeFromTextureCoord(float u, int texture_size) {
  return (u - 0.5 / float(texture_size)) / (1.0 - 1.0 / float(texture_size));
}

vec2 GetTransmittanceTextureUvFromRMu(float r, float mu) {
  float H = sqrt(
    u_top_radius * u_top_radius - u_bottom_radius * u_bottom_radius
  );
  float rho = SafeSqrt(r * r - u_bottom_radius * u_bottom_radius);
  float d = DistanceToTopAtmosphereBoundary(r, mu);
  float d_min = u_top_radius - r;
  float d_max = rho + H;
  float x_mu = (d - d_min) / (d_max - d_min);
  float x_r = rho / H;
  return vec2(
    GetTextureCoordFromUnitRange(x_mu, TRANSMITTANCE_TEXTURE_WIDTH),
    GetTextureCoordFromUnitRange(x_r, TRANSMITTANCE_TEXTURE_HEIGHT)
  );
}

vec3 GetTransmittanceToTopAtmosphereBoundary(
  const sampler2D u_transmittance_texture,
  float r,
  float mu
) {
  vec2 uv = GetTransmittanceTextureUvFromRMu(r, mu);
  return vec3(texture(u_transmittance_texture, uv));
}

vec3 GetTransmittance(
  const sampler2D u_transmittance_texture,
  float r,
  float mu,
  float d,
  bool ray_r_mu_intersects_ground
) {
  float r_d = ClampRadius(sqrt(d * d + 2.0 * r * mu * d + r * r));
  float mu_d = ClampCosine((r * mu + d) / r_d);
  if (ray_r_mu_intersects_ground) {
    return min(
      GetTransmittanceToTopAtmosphereBoundary(
        u_transmittance_texture,
        r_d,
        -mu_d
      ) /
        GetTransmittanceToTopAtmosphereBoundary(
          u_transmittance_texture,
          r,
          -mu
        ),
      vec3(1.0)
    );
  } else {
    return min(
      GetTransmittanceToTopAtmosphereBoundary(u_transmittance_texture, r, mu) /
        GetTransmittanceToTopAtmosphereBoundary(
          u_transmittance_texture,
          r_d,
          mu_d
        ),
      vec3(1.0)
    );
  }
}

vec3 GetTransmittanceToSun(
  const sampler2D u_transmittance_texture,
  float r,
  float mu_s
) {
  float sin_theta_h = u_bottom_radius / r;
  float cos_theta_h = -sqrt(max(1.0 - sin_theta_h * sin_theta_h, 0.0));
  return GetTransmittanceToTopAtmosphereBoundary(
    u_transmittance_texture,
    r,
    mu_s
  ) *
  smoothstep(
    -sin_theta_h * u_sun_angular_radius,
    sin_theta_h * u_sun_angular_radius,
    mu_s - cos_theta_h
  );
}

float DistanceToNearestAtmosphereBoundary(
  float r,
  float mu,
  bool ray_r_mu_intersects_ground
) {
  if (ray_r_mu_intersects_ground) {
    return DistanceToBottomAtmosphereBoundary(r, mu);
  } else {
    return DistanceToTopAtmosphereBoundary(r, mu);
  }
}

float RayleighPhaseFunction(float nu) {
  float k = 3.0 / (16.0 * PI);
  return k * (1.0 + nu * nu);
}

float MiePhaseFunction(float g, float nu) {
  float k = 3.0 / (8.0 * PI) * (1.0 - g * g) / (2.0 + g * g);
  return k * (1.0 + nu * nu) / pow(1.0 + g * g - 2.0 * g * nu, 1.5);
}

vec4 GetScatteringTextureUvwzFromRMuMuSNu(
  float r,
  float mu,
  float mu_s,
  float nu,
  bool ray_r_mu_intersects_ground
) {
  float H = sqrt(
    u_top_radius * u_top_radius - u_bottom_radius * u_bottom_radius
  );
  float rho = SafeSqrt(r * r - u_bottom_radius * u_bottom_radius);
  float u_r = GetTextureCoordFromUnitRange(rho / H, SCATTERING_TEXTURE_R_SIZE);
  float r_mu = r * mu;
  float discriminant = r_mu * r_mu - r * r + u_bottom_radius * u_bottom_radius;
  float u_mu;
  if (ray_r_mu_intersects_ground) {
    float d = -r_mu - SafeSqrt(discriminant);
    float d_min = r - u_bottom_radius;
    float d_max = rho;
    u_mu =
      0.5 -
      0.5 *
        GetTextureCoordFromUnitRange(
          d_max == d_min
            ? 0.0
            : (d - d_min) / (d_max - d_min),
          SCATTERING_TEXTURE_MU_SIZE / 2
        );
  } else {
    float d = -r_mu + SafeSqrt(discriminant + H * H);
    float d_min = u_top_radius - r;
    float d_max = rho + H;
    u_mu =
      0.5 +
      0.5 *
        GetTextureCoordFromUnitRange(
          (d - d_min) / (d_max - d_min),
          SCATTERING_TEXTURE_MU_SIZE / 2
        );
  }
  float d = DistanceToTopAtmosphereBoundary(u_bottom_radius, mu_s);
  float d_min = u_top_radius - u_bottom_radius;
  float d_max = H;
  float a = (d - d_min) / (d_max - d_min);
  float D = DistanceToTopAtmosphereBoundary(u_bottom_radius, u_mu_s_min);
  float A = (D - d_min) / (d_max - d_min);
  float u_mu_s = GetTextureCoordFromUnitRange(
    max(1.0 - a / A, 0.0) / (1.0 + a),
    SCATTERING_TEXTURE_MU_S_SIZE
  );
  float u_nu = (nu + 1.0) / 2.0;
  return vec4(u_nu, u_mu_s, u_mu, u_r);
}

vec2 GetIrradianceTextureUvFromRMuS(float r, float mu_s) {
  float x_r = (r - u_bottom_radius) / (u_top_radius - u_bottom_radius);
  float x_mu_s = mu_s * 0.5 + 0.5;
  return vec2(
    GetTextureCoordFromUnitRange(x_mu_s, IRRADIANCE_TEXTURE_WIDTH),
    GetTextureCoordFromUnitRange(x_r, IRRADIANCE_TEXTURE_HEIGHT)
  );
}

const vec2 IRRADIANCE_TEXTURE_SIZE = vec2(
  IRRADIANCE_TEXTURE_WIDTH,
  IRRADIANCE_TEXTURE_HEIGHT
);

vec3 GetIrradiance(const sampler2D u_irradiance_texture, float r, float mu_s) {
  vec2 uv = GetIrradianceTextureUvFromRMuS(r, mu_s);
  return vec3(texture(u_irradiance_texture, uv));
}

vec3 GetExtrapolatedSingleMieScattering(const vec4 scattering) {
  if (scattering.r <= 0.0) {
    return vec3(0.0);
  }
  return scattering.rgb *
  scattering.a /
  scattering.r *
  (u_rayleigh_scattering.r / u_mie_scattering.r) *
  (u_mie_scattering / u_rayleigh_scattering);
}

vec3 GetCombinedScattering(
  const sampler3D u_scattering_texture,
  const sampler3D u_single_mie_scattering_texture,
  float r,
  float mu,
  float mu_s,
  float nu,
  bool ray_r_mu_intersects_ground,
  out vec3 single_mie_scattering
) {
  vec4 uvwz = GetScatteringTextureUvwzFromRMuMuSNu(
    r,
    mu,
    mu_s,
    nu,
    ray_r_mu_intersects_ground
  );
  float tex_coord_x = uvwz.x * float(SCATTERING_TEXTURE_NU_SIZE - 1);
  float tex_x = floor(tex_coord_x);
  float lerp = tex_coord_x - tex_x;
  vec3 uvw0 = vec3(
    (tex_x + uvwz.y) / float(SCATTERING_TEXTURE_NU_SIZE),
    uvwz.z,
    uvwz.w
  );
  vec3 uvw1 = vec3(
    (tex_x + 1.0 + uvwz.y) / float(SCATTERING_TEXTURE_NU_SIZE),
    uvwz.z,
    uvwz.w
  );
  vec4 combined_scattering =
    texture(u_scattering_texture, uvw0) * (1.0 - lerp) +
    texture(u_scattering_texture, uvw1) * lerp;
  vec3 scattering = vec3(combined_scattering);
  single_mie_scattering = GetExtrapolatedSingleMieScattering(
    combined_scattering
  );
  return scattering;
}

vec3 GetSkyRadiance(
  const sampler2D u_transmittance_texture,
  const sampler3D u_scattering_texture,
  const sampler3D u_single_mie_scattering_texture,
  vec3 camera,
  const vec3 view_ray,
  float shadow_length,
  const vec3 sun_direction,
  out vec3 transmittance
) {
  float r = length(camera);
  float rmu = dot(camera, view_ray);
  float distance_to_top_atmosphere_boundary =
    -rmu - SafeSqrt(rmu * rmu - r * r + u_top_radius * u_top_radius);
  if (distance_to_top_atmosphere_boundary > 0.0) {
    camera = camera + view_ray * distance_to_top_atmosphere_boundary;
    r = u_top_radius;
    rmu += distance_to_top_atmosphere_boundary;
  } else if (r > u_top_radius) {
    transmittance = vec3(1.0);
    return vec3(0.0);
  }
  float mu = rmu / r;
  float mu_s = dot(camera, sun_direction) / r;
  float nu = dot(view_ray, sun_direction);
  bool ray_r_mu_intersects_ground = RayIntersectsGround(r, mu);
  transmittance = ray_r_mu_intersects_ground
    ? vec3(0.0)
    : GetTransmittanceToTopAtmosphereBoundary(u_transmittance_texture, r, mu);
  vec3 single_mie_scattering;
  vec3 scattering;
  if (shadow_length == 0.0) {
    scattering = GetCombinedScattering(
      u_scattering_texture,
      u_single_mie_scattering_texture,
      r,
      mu,
      mu_s,
      nu,
      ray_r_mu_intersects_ground,
      single_mie_scattering
    );
  } else {
    float d = shadow_length;
    float r_p = ClampRadius(sqrt(d * d + 2.0 * r * mu * d + r * r));
    float mu_p = (r * mu + d) / r_p;
    float mu_s_p = (r * mu_s + d * nu) / r_p;
    scattering = GetCombinedScattering(
      u_scattering_texture,
      u_single_mie_scattering_texture,
      r_p,
      mu_p,
      mu_s_p,
      nu,
      ray_r_mu_intersects_ground,
      single_mie_scattering
    );
    vec3 shadow_transmittance = GetTransmittance(
      u_transmittance_texture,
      r,
      mu,
      shadow_length,
      ray_r_mu_intersects_ground
    );
    scattering = scattering * shadow_transmittance;
    single_mie_scattering = single_mie_scattering * shadow_transmittance;
  }
  return scattering * RayleighPhaseFunction(nu) +
  single_mie_scattering * MiePhaseFunction(u_mie_phase_function_g, nu);
}

vec3 GetSkyRadianceToPoint(
  const sampler2D u_transmittance_texture,
  const sampler3D u_scattering_texture,
  const sampler3D u_single_mie_scattering_texture,
  vec3 camera,
  const vec3 point,
  float shadow_length,
  const vec3 sun_direction,
  out vec3 transmittance
) {
  vec3 view_ray = normalize(point - camera);
  float r = length(camera);
  float rmu = dot(camera, view_ray);
  float distance_to_top_atmosphere_boundary =
    -rmu - sqrt(rmu * rmu - r * r + u_top_radius * u_top_radius);
  if (distance_to_top_atmosphere_boundary > 0.0) {
    camera = camera + view_ray * distance_to_top_atmosphere_boundary;
    r = u_top_radius;
    rmu += distance_to_top_atmosphere_boundary;
  }
  float mu = rmu / r;
  float mu_s = dot(camera, sun_direction) / r;
  float nu = dot(view_ray, sun_direction);
  float d = length(point - camera);
  bool ray_r_mu_intersects_ground = RayIntersectsGround(r, mu);

  
  
  
  if (!ray_r_mu_intersects_ground) {
    float mu_horiz = -SafeSqrt(
      1.0 - u_bottom_radius / r * (u_bottom_radius / r)
    );
    mu = max(mu, mu_horiz + 0.004);
  }

  transmittance = GetTransmittance(
    u_transmittance_texture,
    r,
    mu,
    d,
    ray_r_mu_intersects_ground
  );
  vec3 single_mie_scattering;
  vec3 scattering = GetCombinedScattering(
    u_scattering_texture,
    u_single_mie_scattering_texture,
    r,
    mu,
    mu_s,
    nu,
    ray_r_mu_intersects_ground,
    single_mie_scattering
  );
  d = max(d - shadow_length, 0.0);
  float r_p = ClampRadius(sqrt(d * d + 2.0 * r * mu * d + r * r));
  float mu_p = (r * mu + d) / r_p;
  float mu_s_p = (r * mu_s + d * nu) / r_p;
  vec3 single_mie_scattering_p;
  vec3 scattering_p = GetCombinedScattering(
    u_scattering_texture,
    u_single_mie_scattering_texture,
    r_p,
    mu_p,
    mu_s_p,
    nu,
    ray_r_mu_intersects_ground,
    single_mie_scattering_p
  );
  vec3 shadow_transmittance = transmittance;
  if (shadow_length > 0.0) {
    shadow_transmittance = GetTransmittance(
      u_transmittance_texture,
      r,
      mu,
      d,
      ray_r_mu_intersects_ground
    );
  }
  scattering = scattering - shadow_transmittance * scattering_p;
  single_mie_scattering =
    single_mie_scattering - shadow_transmittance * single_mie_scattering_p;
  single_mie_scattering = GetExtrapolatedSingleMieScattering(
    vec4(scattering, single_mie_scattering.r)
  );
  single_mie_scattering =
    single_mie_scattering * smoothstep(float(0.0), float(0.01), mu_s);
  return scattering * RayleighPhaseFunction(nu) +
  single_mie_scattering * MiePhaseFunction(u_mie_phase_function_g, nu);
}

vec3 GetSunAndSkyIrradiance(
  const sampler2D u_transmittance_texture,
  const sampler2D u_irradiance_texture,
  const vec3 point,
  const vec3 normal,
  const vec3 sun_direction,
  out vec3 sky_irradiance
) {
  float r = length(point);
  float mu_s = dot(point, sun_direction) / r;
  sky_irradiance =
    GetIrradiance(u_irradiance_texture, r, mu_s) *
    (1.0 + dot(normal, point) / r) *
    0.5;
  return u_solar_irradiance *
  GetTransmittanceToSun(u_transmittance_texture, r, mu_s) *
  max(dot(normal, sun_direction), 0.0);
}

vec3 GetSolarRadiance() {
  vec3 radiance =
    u_solar_irradiance / (PI * u_sun_angular_radius * u_sun_angular_radius);
  #ifdef PHOTOMETRIC
  radiance *= SUN_SPECTRAL_RADIANCE_TO_LUMINANCE;
  #endif 
  return radiance;
}

vec3 GetSkyRadiance(
  vec3 camera,
  vec3 view_ray,
  float shadow_length,
  vec3 sun_direction,
  out vec3 transmittance
) {
  vec3 radiance = GetSkyRadiance(
    u_transmittance_texture,
    u_scattering_texture,
    u_single_mie_scattering_texture,
    camera,
    view_ray,
    shadow_length,
    sun_direction,
    transmittance
  );
  #ifdef PHOTOMETRIC
  radiance *= SKY_SPECTRAL_RADIANCE_TO_LUMINANCE;
  #endif 
  return radiance;
}

vec3 GetSkyRadianceToPoint(
  vec3 camera,
  vec3 point,
  float shadow_length,
  vec3 sun_direction,
  out vec3 transmittance
) {
  vec3 inscatter = GetSkyRadianceToPoint(
    u_transmittance_texture,
    u_scattering_texture,
    u_single_mie_scattering_texture,
    camera,
    point,
    shadow_length,
    sun_direction,
    transmittance
  );
  #ifdef PHOTOMETRIC
  inscatter *= SKY_SPECTRAL_RADIANCE_TO_LUMINANCE;
  #endif 
  return inscatter;
}

vec3 GetSunAndSkyIrradiance(
  vec3 p,
  vec3 normal,
  vec3 sun_direction,
  out vec3 sky_irradiance
) {
  vec3 sun_irradiance = GetSunAndSkyIrradiance(
    u_transmittance_texture,
    u_irradiance_texture,
    p,
    normal,
    sun_direction,
    sky_irradiance
  );
  #ifdef PHOTOMETRIC
  sun_irradiance *= SUN_SPECTRAL_RADIANCE_TO_LUMINANCE;
  sky_irradiance *= SKY_SPECTRAL_RADIANCE_TO_LUMINANCE;
  #endif 
  return sun_irradiance;
}`,r0=`uniform vec3 u_solar_irradiance;
uniform float u_sun_angular_radius;
uniform float u_bottom_radius;
uniform float u_top_radius;
uniform vec3 u_rayleigh_scattering;
uniform vec3 u_mie_scattering;
uniform float u_mie_phase_function_g;
uniform float u_mu_s_min;

uniform sampler2D u_transmittance_texture;
uniform sampler3D u_scattering_texture;
uniform sampler3D u_single_mie_scattering_texture;
uniform sampler2D u_irradiance_texture;`,Nt=`vec3 getLunarRadiance(const float moonAngularRadius) {
  
  vec3 radiance =
    u_solar_irradiance *
    0.000002 /
    (PI * moonAngularRadius * moonAngularRadius);
  #ifdef PHOTOMETRIC
  radiance *= SUN_SPECTRAL_RADIANCE_TO_LUMINANCE;
  #endif 
  return radiance;
}

float intersectSphere(const vec3 ray, const vec3 point, const float radius) {
  vec3 P = -point;
  float PoR = dot(P, ray);
  float D = dot(P, P) - radius * radius;
  return -PoR - sqrt(PoR * PoR - D);
}

float orenNayarDiffuse(const vec3 L, const vec3 V, const vec3 N) {
  float NoL = dot(N, L);
  float NoV = dot(N, V);
  float s = dot(L, V) - NoL * NoV;
  float t = mix(1.0, max(NoL, NoV), step(0.0, s));
  return max(0.0, NoL) * (0.62406015 + 0.41284404 * s / t);
}

vec3 getSkyRadiance(
  const vec3 viewPosition,
  const vec3 rayDirection,
  const vec3 sunDirection,
  const vec3 moonDirection,
  const float moonAngularRadius,
  const float lunarRadianceScale
) {
  vec3 transmittance;
  vec3 radiance = GetSkyRadiance(
    viewPosition,
    rayDirection,
    0.0, 
    sunDirection,
    transmittance
  );

  
  #ifdef PERSPECTIVE_CAMERA

  #if defined(SUN) || defined(MOON)
  vec3 ddx = dFdx(rayDirection);
  vec3 ddy = dFdy(rayDirection);
  float fragmentAngle = length(ddx + ddy) / length(rayDirection);
  #endif 

  #ifdef SUN
  float viewDotSun = dot(rayDirection, sunDirection);
  if (viewDotSun > cos(u_sun_angular_radius)) {
    float angle = acos(clamp(viewDotSun, -1.0, 1.0));
    float antialias = smoothstep(
      u_sun_angular_radius,
      u_sun_angular_radius - fragmentAngle,
      angle
    );
    radiance += transmittance * GetSolarRadiance() * antialias;
  }
  #endif 

  #ifdef MOON
  float intersection = intersectSphere(
    rayDirection,
    moonDirection,
    moonAngularRadius
  );
  if (intersection > 0.0) {
    vec3 normal = normalize(moonDirection - rayDirection * intersection);
    float diffuse = orenNayarDiffuse(-sunDirection, rayDirection, normal);
    float viewDotMoon = dot(rayDirection, moonDirection);
    float angle = acos(clamp(viewDotMoon, -1.0, 1.0));
    float antialias = smoothstep(
      moonAngularRadius,
      moonAngularRadius - fragmentAngle,
      angle
    );
    radiance +=
      transmittance *
      getLunarRadiance(moonAngularRadius) *
      lunarRadianceScale *
      diffuse *
      antialias;
  }
  #endif 

  #endif 

  return radiance;
}`;const W0=new c.Vector3,on=new y.Geodetic,Dt={blendFunction:Y0.BlendFunction.NORMAL,octEncodedNormal:!1,reconstructNormal:!1,ellipsoid:y.Ellipsoid.WGS84,correctAltitude:!0,correctGeometricError:!0,photometric:!0,sunIrradiance:!1,skyIrradiance:!1,transmittance:!0,inscatter:!0,irradianceScale:1,sky:!1,sun:!0,moon:!0,moonAngularRadius:.0045,lunarRadianceScale:1};class an extends Y0.Effect{constructor(n=new c.Camera,r,i=X.DEFAULT){const{blendFunction:o,normalBuffer:s=null,octEncodedNormal:u,reconstructNormal:a,irradianceTexture:d=null,scatteringTexture:_=null,transmittanceTexture:m=null,useHalfFloat:f,ellipsoid:T,correctAltitude:h,correctGeometricError:v,photometric:S,sunDirection:C,sunIrradiance:N,skyIrradiance:D,transmittance:P,inscatter:G,irradianceScale:L,sky:O,sun:v0,moon:a0,moonDirection:Y,moonAngularRadius:g0,lunarRadianceScale:s0}={...Dt,...r};super("AerialPerspectiveEffect",`
        ${r0}
        ${ut}
        ${y.depthShader}
        ${y.packingShader}
        ${y.transformShader}
        ${Nt}
        ${en}
      `,{blendFunction:o,vertexShader:`
          ${r0}
          ${rn}
        `,attributes:Y0.EffectAttribute.DEPTH,uniforms:new Map([["u_solar_irradiance",new c.Uniform(i.solarIrradiance)],["u_sun_angular_radius",new c.Uniform(i.sunAngularRadius)],["u_bottom_radius",new c.Uniform(i.bottomRadius*j)],["u_top_radius",new c.Uniform(i.topRadius*j)],["u_rayleigh_scattering",new c.Uniform(i.rayleighScattering)],["u_mie_scattering",new c.Uniform(i.mieScattering)],["u_mie_phase_function_g",new c.Uniform(i.miePhaseFunctionG)],["u_mu_s_min",new c.Uniform(0)],["u_irradiance_texture",new c.Uniform(d)],["u_scattering_texture",new c.Uniform(_)],["u_single_mie_scattering_texture",new c.Uniform(_)],["u_transmittance_texture",new c.Uniform(m)],["normalBuffer",new c.Uniform(s)],["projectionMatrix",new c.Uniform(new c.Matrix4)],["inverseProjectionMatrix",new c.Uniform(new c.Matrix4)],["inverseViewMatrix",new c.Uniform(new c.Matrix4)],["cameraPosition",new c.Uniform(new c.Vector3)],["cameraHeight",new c.Uniform(0)],["ellipsoidCenter",new c.Uniform(new c.Vector3)],["ellipsoidRadii",new c.Uniform(new c.Vector3)],["sunDirection",new c.Uniform((C==null?void 0:C.clone())??new c.Vector3)],["irradianceScale",new c.Uniform(L)],["idealSphereAlpha",new c.Uniform(0)],["moonDirection",new c.Uniform((Y==null?void 0:Y.clone())??new c.Vector3)],["moonAngularRadius",new c.Uniform(g0)],["lunarRadianceScale",new c.Uniform(s0)]]),defines:new Map([["TRANSMITTANCE_TEXTURE_WIDTH",`${m0}`],["TRANSMITTANCE_TEXTURE_HEIGHT",`${f0}`],["SCATTERING_TEXTURE_R_SIZE",`${U0}`],["SCATTERING_TEXTURE_MU_SIZE",`${G0}`],["SCATTERING_TEXTURE_MU_S_SIZE",`${O0}`],["SCATTERING_TEXTURE_NU_SIZE",`${b0}`],["IRRADIANCE_TEXTURE_WIDTH",`${d0}`],["IRRADIANCE_TEXTURE_HEIGHT",`${_0}`],["METER_TO_UNIT_LENGTH",`float(${j})`],["SUN_SPECTRAL_RADIANCE_TO_LUMINANCE",`vec3(${i.sunRadianceToRelativeLuminance.toArray().join(",")})`],["SKY_SPECTRAL_RADIANCE_TO_LUMINANCE",`vec3(${i.skyRadianceToRelativeLuminance.toArray().join(",")})`]])});g(this,"atmosphere");g(this,"_ellipsoid");g(this,"correctAltitude");this.camera=n,this.camera=n,this.atmosphere=i,this.octEncodedNormal=u,this.reconstructNormal=a,this.useHalfFloat=f===!0,this.ellipsoid=T,this.correctAltitude=h,this.correctGeometricError=v,this.photometric=S,this.sunIrradiance=N,this.skyIrradiance=D,this.transmittance=P,this.inscatter=G,this.sky=O,this.sun=v0,this.moon=a0}get mainCamera(){return this.camera}set mainCamera(n){this.camera=n}update(n,r,i){const o=this.uniforms,s=o.get("projectionMatrix"),u=o.get("inverseProjectionMatrix"),a=o.get("inverseViewMatrix"),d=this.camera;s.value.copy(d.projectionMatrix),u.value.copy(d.projectionMatrixInverse),a.value.copy(d.matrixWorld);const _=o.get("cameraPosition"),m=o.get("cameraHeight"),f=d.getWorldPosition(_.value);m.value=on.setFromECEF(f).height;const T=o.get("idealSphereAlpha");W0.set(0,this.ellipsoid.maximumRadius,-m.value).applyMatrix4(d.projectionMatrix);let h=c.MathUtils.mapLinear(W0.y,41.5,13.8,0,1);h=c.MathUtils.clamp(h,0,1),T.value=h;const v=o.get("ellipsoidCenter");if(this.correctAltitude){const S=this.ellipsoid.projectOnSurface(f,W0);S!=null&&this.ellipsoid.getOsculatingSphereCenter(S.lengthSq()<f.lengthSq()?S:f,this.atmosphere.bottomRadius,v.value)}else v.value.set(0,0,0)}get normalBuffer(){return this.uniforms.get("normalBuffer").value}set normalBuffer(n){this.uniforms.get("normalBuffer").value=n}get octEncodedNormal(){return this.defines.has("OCT_ENCODED_NORMAL")}set octEncodedNormal(n){n!==this.octEncodedNormal&&(n?this.defines.set("OCT_ENCODED_NORMAL","1"):this.defines.delete("OCT_ENCODED_NORMAL"),this.setChanged())}get reconstructNormal(){return this.defines.has("RECONSTRUCT_NORMAL")}set reconstructNormal(n){n!==this.reconstructNormal&&(n?this.defines.set("RECONSTRUCT_NORMAL","1"):this.defines.delete("RECONSTRUCT_NORMAL"),this.setChanged())}get irradianceTexture(){return this.uniforms.get("u_irradiance_texture").value}set irradianceTexture(n){this.uniforms.get("u_irradiance_texture").value=n}get scatteringTexture(){return this.uniforms.get("u_scattering_texture").value}set scatteringTexture(n){this.uniforms.get("u_scattering_texture").value=n,this.uniforms.get("u_single_mie_scattering_texture").value=n}get transmittanceTexture(){return this.uniforms.get("u_transmittance_texture").value}set transmittanceTexture(n){this.uniforms.get("u_transmittance_texture").value=n}get useHalfFloat(){return this.uniforms.get("u_mu_s_min").value===this.atmosphere.muSMinHalfFloat}set useHalfFloat(n){this.uniforms.get("u_mu_s_min").value=n?this.atmosphere.muSMinHalfFloat:this.atmosphere.muSMinFloat}get ellipsoid(){return this._ellipsoid}set ellipsoid(n){this._ellipsoid=n,this.uniforms.get("ellipsoidRadii").value.copy(n.radii)}get correctGeometricError(){return this.defines.has("CORRECT_GEOMETRIC_ERROR")}set correctGeometricError(n){n!==this.correctGeometricError&&(n?this.defines.set("CORRECT_GEOMETRIC_ERROR","1"):this.defines.delete("CORRECT_GEOMETRIC_ERROR"),this.setChanged())}get photometric(){return this.defines.has("PHOTOMETRIC")}set photometric(n){n!==this.photometric&&(n?this.defines.set("PHOTOMETRIC","1"):this.defines.delete("PHOTOMETRIC"),this.setChanged())}get sunDirection(){return this.uniforms.get("sunDirection").value}get sunIrradiance(){return this.defines.has("SUN_IRRADIANCE")}set sunIrradiance(n){n!==this.sunIrradiance&&(n?this.defines.set("SUN_IRRADIANCE","1"):this.defines.delete("SUN_IRRADIANCE"),this.setChanged())}get skyIrradiance(){return this.defines.has("SKY_IRRADIANCE")}set skyIrradiance(n){n!==this.skyIrradiance&&(n?this.defines.set("SKY_IRRADIANCE","1"):this.defines.delete("SKY_IRRADIANCE"),this.setChanged())}get transmittance(){return this.defines.has("TRANSMITTANCE")}set transmittance(n){n!==this.transmittance&&(n?this.defines.set("TRANSMITTANCE","1"):this.defines.delete("TRANSMITTANCE"),this.setChanged())}get inscatter(){return this.defines.has("INSCATTER")}set inscatter(n){n!==this.inscatter&&(n?this.defines.set("INSCATTER","1"):this.defines.delete("INSCATTER"),this.setChanged())}get irradianceScale(){return this.uniforms.get("irradianceScale").value}set irradianceScale(n){this.uniforms.get("irradianceScale").value=n}get sky(){return this.defines.has("SKY")}set sky(n){n!==this.sky&&(n?this.defines.set("SKY","1"):this.defines.delete("SKY"),this.setChanged())}get sun(){return this.defines.has("SUN")}set sun(n){n!==this.sun&&(n?this.defines.set("SUN","1"):this.defines.delete("SUN"),this.setChanged())}get moon(){return this.defines.has("MOON")}set moon(n){n!==this.moon&&(n?this.defines.set("MOON","1"):this.defines.delete("MOON"),this.setChanged())}get moonDirection(){return this.uniforms.get("moonDirection").value}get moonAngularRadius(){return this.uniforms.get("moonAngularRadius").value}set moonAngularRadius(n){this.uniforms.get("moonAngularRadius").value=n}get lunarRadianceScale(){return this.uniforms.get("lunarRadianceScale").value}set lunarRadianceScale(n){this.uniforms.get("lunarRadianceScale").value=n}}const sn=new c.Vector3;function cn(e,t){let n="",r="";for(let i=1;i<t;++i)n+=`layout(location = ${i}) out float renderTarget${i};
`,r+=`renderTarget${i} = 0.0;
`;return e.replace("#include <mrt_layout>",n).replace("#include <mrt_output>",r)}const L0={useHalfFloat:!1,ellipsoid:y.Ellipsoid.WGS84,correctAltitude:!0,photometric:!0,renderTargetCount:1};class lt extends c.RawShaderMaterial{constructor(n,r=X.DEFAULT){const{irradianceTexture:i=null,scatteringTexture:o=null,transmittanceTexture:s=null,useHalfFloat:u,ellipsoid:a,correctAltitude:d,photometric:_,sunDirection:m,sunAngularRadius:f,renderTargetCount:T,...h}={...L0,...n};super({toneMapped:!1,depthWrite:!1,depthTest:!1,...h,uniforms:{u_solar_irradiance:new c.Uniform(r.solarIrradiance),u_sun_angular_radius:new c.Uniform(f??r.sunAngularRadius),u_bottom_radius:new c.Uniform(r.bottomRadius*j),u_top_radius:new c.Uniform(r.topRadius*j),u_rayleigh_scattering:new c.Uniform(r.rayleighScattering),u_mie_scattering:new c.Uniform(r.mieScattering),u_mie_phase_function_g:new c.Uniform(r.miePhaseFunctionG),u_mu_s_min:new c.Uniform(0),u_irradiance_texture:new c.Uniform(i),u_scattering_texture:new c.Uniform(o),u_single_mie_scattering_texture:new c.Uniform(o),u_transmittance_texture:new c.Uniform(s),cameraPosition:new c.Uniform(new c.Vector3),ellipsoidCenter:new c.Uniform(new c.Vector3),sunDirection:new c.Uniform((m==null?void 0:m.clone())??new c.Vector3),...h.uniforms},defines:{PI:`${Math.PI}`,TRANSMITTANCE_TEXTURE_WIDTH:`${m0}`,TRANSMITTANCE_TEXTURE_HEIGHT:`${f0}`,SCATTERING_TEXTURE_R_SIZE:`${U0}`,SCATTERING_TEXTURE_MU_SIZE:`${G0}`,SCATTERING_TEXTURE_MU_S_SIZE:`${O0}`,SCATTERING_TEXTURE_NU_SIZE:`${b0}`,IRRADIANCE_TEXTURE_WIDTH:`${d0}`,IRRADIANCE_TEXTURE_HEIGHT:`${_0}`,METER_TO_UNIT_LENGTH:`float(${j})`,SUN_SPECTRAL_RADIANCE_TO_LUMINANCE:`vec3(${r.sunRadianceToRelativeLuminance.toArray().join(",")})`,SKY_SPECTRAL_RADIANCE_TO_LUMINANCE:`vec3(${r.skyRadianceToRelativeLuminance.toArray().join(",")})`,...h.defines}});g(this,"atmosphere");g(this,"ellipsoid");g(this,"correctAltitude");g(this,"_renderTargetCount");this.atmosphere=r,this.useHalfFloat=u,this.ellipsoid=a,this.correctAltitude=d,this.photometric=_,this.renderTargetCount=T}onBeforeCompile(n,r){n.fragmentShader=cn(n.fragmentShader,this.renderTargetCount)}onBeforeRender(n,r,i,o,s,u){const a=this.uniforms,d=i.getWorldPosition(a.cameraPosition.value);if(this.correctAltitude){const _=this.ellipsoid.projectOnSurface(d,sn);_!=null&&this.ellipsoid.getOsculatingSphereCenter(_.lengthSq()<d.lengthSq()?_:d,this.atmosphere.bottomRadius,a.ellipsoidCenter.value)}else a.ellipsoidCenter.value.set(0,0,0)}get irradianceTexture(){return this.uniforms.u_irradiance_texture.value}set irradianceTexture(n){this.uniforms.u_irradiance_texture.value=n}get scatteringTexture(){return this.uniforms.u_scattering_texture.value}set scatteringTexture(n){this.uniforms.u_scattering_texture.value=n,this.uniforms.u_single_mie_scattering_texture.value=n}get transmittanceTexture(){return this.uniforms.u_transmittance_texture.value}set transmittanceTexture(n){this.uniforms.u_transmittance_texture.value=n}get useHalfFloat(){return this.uniforms.u_mu_s_min.value===this.atmosphere.muSMinHalfFloat}set useHalfFloat(n){this.uniforms.u_mu_s_min.value=n?this.atmosphere.muSMinHalfFloat:this.atmosphere.muSMinFloat}get photometric(){return this.defines.PHOTOMETRIC!=null}set photometric(n){n!==this.photometric&&(n?this.defines.PHOTOMETRIC="1":delete this.defines.PHOTOMETRIC,this.needsUpdate=!0)}get sunDirection(){return this.uniforms.sunDirection.value}get sunAngularRadius(){return this.uniforms.u_sun_angular_radius.value}set sunAngularRadius(n){this.uniforms.u_sun_angular_radius.value=n}get renderTargetCount(){return this._renderTargetCount}set renderTargetCount(n){n!==this.renderTargetCount&&(this._renderTargetCount=n,this.needsUpdate=!0)}}/**
    @preserve

    Astronomy library for JavaScript (browser and Node.js).
    https://github.com/cosinekitty/astronomy

    MIT License

    Copyright (c) 2019-2023 Don Cross <cosinekitty@gmail.com>

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.
*//**
 * @fileoverview Astronomy calculation library for browser scripting and Node.js.
 * @author Don Cross <cosinekitty@gmail.com>
 * @license MIT
 */const un=173.1446326846693,ln=14959787069098932e-8,i0=.017453292519943295,dn=365.24217,Tt=new Date("2000-01-01T12:00:00Z"),F=2*Math.PI,$=3600*(180/Math.PI),Q=484813681109536e-20,_n=180*60*60,mn=2*_n,fn=6378.1366,hn=fn/ln,vn=81.30056,dt=.0002959122082855911,K0=2825345909524226e-22,J0=8459715185680659e-23,Q0=1292024916781969e-23,tt=1524358900784276e-23;function X0(e){if(!Number.isFinite(e))throw console.trace(),`Value is not a finite number: ${e}`;return e}function J(e){return e-Math.floor(e)}var E;(function(e){e.Sun="Sun",e.Moon="Moon",e.Mercury="Mercury",e.Venus="Venus",e.Earth="Earth",e.Mars="Mars",e.Jupiter="Jupiter",e.Saturn="Saturn",e.Uranus="Uranus",e.Neptune="Neptune",e.Pluto="Pluto",e.SSB="SSB",e.EMB="EMB",e.Star1="Star1",e.Star2="Star2",e.Star3="Star3",e.Star4="Star4",e.Star5="Star5",e.Star6="Star6",e.Star7="Star7",e.Star8="Star8"})(E||(E={}));const gn=[E.Star1,E.Star2,E.Star3,E.Star4,E.Star5,E.Star6,E.Star7,E.Star8],Tn=[{ra:0,dec:0,dist:0},{ra:0,dec:0,dist:0},{ra:0,dec:0,dist:0},{ra:0,dec:0,dist:0},{ra:0,dec:0,dist:0},{ra:0,dec:0,dist:0},{ra:0,dec:0,dist:0},{ra:0,dec:0,dist:0}];function pn(e){const t=gn.indexOf(e);return t>=0?Tn[t]:null}function Pt(e){const t=pn(e);return t&&t.dist>0?t:null}var V;(function(e){e[e.From2000=0]="From2000",e[e.Into2000=1]="Into2000"})(V||(V={}));const t0={Mercury:[[[[4.40250710144,0,0],[.40989414977,1.48302034195,26087.9031415742],[.050462942,4.47785489551,52175.8062831484],[.00855346844,1.16520322459,78263.70942472259],[.00165590362,4.11969163423,104351.61256629678],[.00034561897,.77930768443,130439.51570787099],[7583476e-11,3.71348404924,156527.41884944518]],[[26087.90313685529,0,0],[.01131199811,6.21874197797,26087.9031415742],[.00292242298,3.04449355541,52175.8062831484],[.00075775081,6.08568821653,78263.70942472259],[.00019676525,2.80965111777,104351.61256629678]]],[[[.11737528961,1.98357498767,26087.9031415742],[.02388076996,5.03738959686,52175.8062831484],[.01222839532,3.14159265359,0],[.0054325181,1.79644363964,78263.70942472259],[.0012977877,4.83232503958,104351.61256629678],[.00031866927,1.58088495658,130439.51570787099],[7963301e-11,4.60972126127,156527.41884944518]],[[.00274646065,3.95008450011,26087.9031415742],[.00099737713,3.14159265359,0]]],[[[.39528271651,0,0],[.07834131818,6.19233722598,26087.9031415742],[.00795525558,2.95989690104,52175.8062831484],[.00121281764,6.01064153797,78263.70942472259],[.00021921969,2.77820093972,104351.61256629678],[4354065e-11,5.82894543774,130439.51570787099]],[[.0021734774,4.65617158665,26087.9031415742],[.00044141826,1.42385544001,52175.8062831484]]]],Venus:[[[[3.17614666774,0,0],[.01353968419,5.59313319619,10213.285546211],[.00089891645,5.30650047764,20426.571092422],[5477194e-11,4.41630661466,7860.4193924392],[3455741e-11,2.6996444782,11790.6290886588],[2372061e-11,2.99377542079,3930.2096962196],[1317168e-11,5.18668228402,26.2983197998],[1664146e-11,4.25018630147,1577.3435424478],[1438387e-11,4.15745084182,9683.5945811164],[1200521e-11,6.15357116043,30639.856638633]],[[10213.28554621638,0,0],[.00095617813,2.4640651111,10213.285546211],[7787201e-11,.6247848222,20426.571092422]]],[[[.05923638472,.26702775812,10213.285546211],[.00040107978,1.14737178112,20426.571092422],[.00032814918,3.14159265359,0]],[[.00287821243,1.88964962838,10213.285546211]]],[[[.72334820891,0,0],[.00489824182,4.02151831717,10213.285546211],[1658058e-11,4.90206728031,20426.571092422],[1378043e-11,1.12846591367,11790.6290886588],[1632096e-11,2.84548795207,7860.4193924392],[498395e-11,2.58682193892,9683.5945811164],[221985e-11,2.01346696541,19367.1891622328],[237454e-11,2.55136053886,15720.8387848784]],[[.00034551041,.89198706276,10213.285546211]]]],Earth:[[[[1.75347045673,0,0],[.03341656453,4.66925680415,6283.0758499914],[.00034894275,4.62610242189,12566.1516999828],[3417572e-11,2.82886579754,3.523118349],[3497056e-11,2.74411783405,5753.3848848968],[3135899e-11,3.62767041756,77713.7714681205],[2676218e-11,4.41808345438,7860.4193924392],[2342691e-11,6.13516214446,3930.2096962196],[1273165e-11,2.03709657878,529.6909650946],[1324294e-11,.74246341673,11506.7697697936],[901854e-11,2.04505446477,26.2983197998],[1199167e-11,1.10962946234,1577.3435424478],[857223e-11,3.50849152283,398.1490034082],[779786e-11,1.17882681962,5223.6939198022],[99025e-10,5.23268072088,5884.9268465832],[753141e-11,2.53339052847,5507.5532386674],[505267e-11,4.58292599973,18849.2275499742],[492392e-11,4.20505711826,775.522611324],[356672e-11,2.91954114478,.0673103028],[284125e-11,1.89869240932,796.2980068164],[242879e-11,.34481445893,5486.777843175],[317087e-11,5.84901948512,11790.6290886588],[271112e-11,.31486255375,10977.078804699],[206217e-11,4.80646631478,2544.3144198834],[205478e-11,1.86953770281,5573.1428014331],[202318e-11,2.45767790232,6069.7767545534],[126225e-11,1.08295459501,20.7753954924],[155516e-11,.83306084617,213.299095438]],[[6283.0758499914,0,0],[.00206058863,2.67823455808,6283.0758499914],[4303419e-11,2.63512233481,12566.1516999828]],[[8721859e-11,1.07253635559,6283.0758499914]]],[[],[[.00227777722,3.4137662053,6283.0758499914],[3805678e-11,3.37063423795,12566.1516999828]]],[[[1.00013988784,0,0],[.01670699632,3.09846350258,6283.0758499914],[.00013956024,3.05524609456,12566.1516999828],[308372e-10,5.19846674381,77713.7714681205],[1628463e-11,1.17387558054,5753.3848848968],[1575572e-11,2.84685214877,7860.4193924392],[924799e-11,5.45292236722,11506.7697697936],[542439e-11,4.56409151453,3930.2096962196],[47211e-10,3.66100022149,5884.9268465832],[85831e-11,1.27079125277,161000.6857376741],[57056e-11,2.01374292245,83996.84731811189],[55736e-11,5.2415979917,71430.69561812909],[174844e-11,3.01193636733,18849.2275499742],[243181e-11,4.2734953079,11790.6290886588]],[[.00103018607,1.10748968172,6283.0758499914],[1721238e-11,1.06442300386,12566.1516999828]],[[4359385e-11,5.78455133808,6283.0758499914]]]],Mars:[[[[6.20347711581,0,0],[.18656368093,5.0503710027,3340.6124266998],[.01108216816,5.40099836344,6681.2248533996],[.00091798406,5.75478744667,10021.8372800994],[.00027744987,5.97049513147,3.523118349],[.00010610235,2.93958560338,2281.2304965106],[.00012315897,.84956094002,2810.9214616052],[8926784e-11,4.15697846427,.0172536522],[8715691e-11,6.11005153139,13362.4497067992],[6797556e-11,.36462229657,398.1490034082],[7774872e-11,3.33968761376,5621.8429232104],[3575078e-11,1.6618650571,2544.3144198834],[4161108e-11,.22814971327,2942.4634232916],[3075252e-11,.85696614132,191.4482661116],[2628117e-11,.64806124465,3337.0893083508],[2937546e-11,6.07893711402,.0673103028],[2389414e-11,5.03896442664,796.2980068164],[2579844e-11,.02996736156,3344.1355450488],[1528141e-11,1.14979301996,6151.533888305],[1798806e-11,.65634057445,529.6909650946],[1264357e-11,3.62275122593,5092.1519581158],[1286228e-11,3.06796065034,2146.1654164752],[1546404e-11,2.91579701718,1751.539531416],[1024902e-11,3.69334099279,8962.4553499102],[891566e-11,.18293837498,16703.062133499],[858759e-11,2.4009381194,2914.0142358238],[832715e-11,2.46418619474,3340.5951730476],[83272e-10,4.49495782139,3340.629680352],[712902e-11,3.66335473479,1059.3819301892],[748723e-11,3.82248614017,155.4203994342],[723861e-11,.67497311481,3738.761430108],[635548e-11,2.92182225127,8432.7643848156],[655162e-11,.48864064125,3127.3133312618],[550474e-11,3.81001042328,.9803210682],[55275e-10,4.47479317037,1748.016413067],[425966e-11,.55364317304,6283.0758499914],[415131e-11,.49662285038,213.299095438],[472167e-11,3.62547124025,1194.4470102246],[306551e-11,.38052848348,6684.7479717486],[312141e-11,.99853944405,6677.7017350506],[293198e-11,4.22131299634,20.7753954924],[302375e-11,4.48618007156,3532.0606928114],[274027e-11,.54222167059,3340.545116397],[281079e-11,5.88163521788,1349.8674096588],[231183e-11,1.28242156993,3870.3033917944],[283602e-11,5.7688543494,3149.1641605882],[236117e-11,5.75503217933,3333.498879699],[274033e-11,.13372524985,3340.6797370026],[299395e-11,2.78323740866,6254.6266625236]],[[3340.61242700512,0,0],[.01457554523,3.60433733236,3340.6124266998],[.00168414711,3.92318567804,6681.2248533996],[.00020622975,4.26108844583,10021.8372800994],[3452392e-11,4.7321039319,3.523118349],[2586332e-11,4.60670058555,13362.4497067992],[841535e-11,4.45864030426,2281.2304965106]],[[.00058152577,2.04961712429,3340.6124266998],[.00013459579,2.45738706163,6681.2248533996]]],[[[.03197134986,3.76832042431,3340.6124266998],[.00298033234,4.10616996305,6681.2248533996],[.00289104742,0,0],[.00031365539,4.4465105309,10021.8372800994],[34841e-9,4.7881254926,13362.4497067992]],[[.00217310991,6.04472194776,3340.6124266998],[.00020976948,3.14159265359,0],[.00012834709,1.60810667915,6681.2248533996]]],[[[1.53033488271,0,0],[.1418495316,3.47971283528,3340.6124266998],[.00660776362,3.81783443019,6681.2248533996],[.00046179117,4.15595316782,10021.8372800994],[8109733e-11,5.55958416318,2810.9214616052],[7485318e-11,1.77239078402,5621.8429232104],[5523191e-11,1.3643630377,2281.2304965106],[382516e-10,4.49407183687,13362.4497067992],[2306537e-11,.09081579001,2544.3144198834],[1999396e-11,5.36059617709,3337.0893083508],[2484394e-11,4.9254563992,2942.4634232916],[1960195e-11,4.74249437639,3344.1355450488],[1167119e-11,2.11260868341,5092.1519581158],[1102816e-11,5.00908403998,398.1490034082],[899066e-11,4.40791133207,529.6909650946],[992252e-11,5.83861961952,6151.533888305],[807354e-11,2.10217065501,1059.3819301892],[797915e-11,3.44839203899,796.2980068164],[740975e-11,1.49906336885,2146.1654164752]],[[.01107433345,2.03250524857,3340.6124266998],[.00103175887,2.37071847807,6681.2248533996],[128772e-9,0,0],[.0001081588,2.70888095665,10021.8372800994]],[[.00044242249,.47930604954,3340.6124266998],[8138042e-11,.86998389204,6681.2248533996]]]],Jupiter:[[[[.59954691494,0,0],[.09695898719,5.06191793158,529.6909650946],[.00573610142,1.44406205629,7.1135470008],[.00306389205,5.41734730184,1059.3819301892],[.00097178296,4.14264726552,632.7837393132],[.00072903078,3.64042916389,522.5774180938],[.00064263975,3.41145165351,103.0927742186],[.00039806064,2.29376740788,419.4846438752],[.00038857767,1.27231755835,316.3918696566],[.00027964629,1.7845459182,536.8045120954],[.0001358973,5.7748104079,1589.0728952838],[8246349e-11,3.5822792584,206.1855484372],[8768704e-11,3.63000308199,949.1756089698],[7368042e-11,5.0810119427,735.8765135318],[626315e-10,.02497628807,213.299095438],[6114062e-11,4.51319998626,1162.4747044078],[4905396e-11,1.32084470588,110.2063212194],[5305285e-11,1.30671216791,14.2270940016],[5305441e-11,4.18625634012,1052.2683831884],[4647248e-11,4.69958103684,3.9321532631],[3045023e-11,4.31676431084,426.598190876],[2609999e-11,1.56667394063,846.0828347512],[2028191e-11,1.06376530715,3.1813937377],[1764763e-11,2.14148655117,1066.49547719],[1722972e-11,3.88036268267,1265.5674786264],[1920945e-11,.97168196472,639.897286314],[1633223e-11,3.58201833555,515.463871093],[1431999e-11,4.29685556046,625.6701923124],[973272e-11,4.09764549134,95.9792272178]],[[529.69096508814,0,0],[.00489503243,4.2208293947,529.6909650946],[.00228917222,6.02646855621,7.1135470008],[.00030099479,4.54540782858,1059.3819301892],[.0002072092,5.45943156902,522.5774180938],[.00012103653,.16994816098,536.8045120954],[6067987e-11,4.42422292017,103.0927742186],[5433968e-11,3.98480737746,419.4846438752],[4237744e-11,5.89008707199,14.2270940016]],[[.00047233601,4.32148536482,7.1135470008],[.00030649436,2.929777887,529.6909650946],[.00014837605,3.14159265359,0]]],[[[.02268615702,3.55852606721,529.6909650946],[.00109971634,3.90809347197,1059.3819301892],[.00110090358,0,0],[8101428e-11,3.60509572885,522.5774180938],[6043996e-11,4.25883108339,1589.0728952838],[6437782e-11,.30627119215,536.8045120954]],[[.00078203446,1.52377859742,529.6909650946]]],[[[5.20887429326,0,0],[.25209327119,3.49108639871,529.6909650946],[.00610599976,3.84115365948,1059.3819301892],[.00282029458,2.57419881293,632.7837393132],[.00187647346,2.07590383214,522.5774180938],[.00086792905,.71001145545,419.4846438752],[.00072062974,.21465724607,536.8045120954],[.00065517248,5.9799588479,316.3918696566],[.00029134542,1.67759379655,103.0927742186],[.00030135335,2.16132003734,949.1756089698],[.00023453271,3.54023522184,735.8765135318],[.00022283743,4.19362594399,1589.0728952838],[.00023947298,.2745803748,7.1135470008],[.00013032614,2.96042965363,1162.4747044078],[970336e-10,1.90669633585,206.1855484372],[.00012749023,2.71550286592,1052.2683831884],[7057931e-11,2.18184839926,1265.5674786264],[6137703e-11,6.26418240033,846.0828347512],[2616976e-11,2.00994012876,1581.959348283]],[[.0127180152,2.64937512894,529.6909650946],[.00061661816,3.00076460387,1059.3819301892],[.00053443713,3.89717383175,522.5774180938],[.00031185171,4.88276958012,536.8045120954],[.00041390269,0,0]]]],Saturn:[[[[.87401354025,0,0],[.11107659762,3.96205090159,213.299095438],[.01414150957,4.58581516874,7.1135470008],[.00398379389,.52112032699,206.1855484372],[.00350769243,3.30329907896,426.598190876],[.00206816305,.24658372002,103.0927742186],[792713e-9,3.84007056878,220.4126424388],[.00023990355,4.66976924553,110.2063212194],[.00016573588,.43719228296,419.4846438752],[.00014906995,5.76903183869,316.3918696566],[.0001582029,.93809155235,632.7837393132],[.00014609559,1.56518472,3.9321532631],[.00013160301,4.44891291899,14.2270940016],[.00015053543,2.71669915667,639.897286314],[.00013005299,5.98119023644,11.0457002639],[.00010725067,3.12939523827,202.2533951741],[5863206e-11,.23656938524,529.6909650946],[5227757e-11,4.20783365759,3.1813937377],[6126317e-11,1.76328667907,277.0349937414],[5019687e-11,3.17787728405,433.7117378768],[459255e-10,.61977744975,199.0720014364],[4005867e-11,2.24479718502,63.7358983034],[2953796e-11,.98280366998,95.9792272178],[387367e-10,3.22283226966,138.5174968707],[2461186e-11,2.03163875071,735.8765135318],[3269484e-11,.77492638211,949.1756089698],[1758145e-11,3.2658010994,522.5774180938],[1640172e-11,5.5050445305,846.0828347512],[1391327e-11,4.02333150505,323.5054166574],[1580648e-11,4.37265307169,309.2783226558],[1123498e-11,2.83726798446,415.5524906121],[1017275e-11,3.71700135395,227.5261894396],[848642e-11,3.1915017083,209.3669421749]],[[213.2990952169,0,0],[.01297370862,1.82834923978,213.299095438],[.00564345393,2.88499717272,7.1135470008],[.00093734369,1.06311793502,426.598190876],[.00107674962,2.27769131009,206.1855484372],[.00040244455,2.04108104671,220.4126424388],[.00019941774,1.2795439047,103.0927742186],[.00010511678,2.7488034213,14.2270940016],[6416106e-11,.38238295041,639.897286314],[4848994e-11,2.43037610229,419.4846438752],[4056892e-11,2.92133209468,110.2063212194],[3768635e-11,3.6496533078,3.9321532631]],[[.0011644133,1.17988132879,7.1135470008],[.00091841837,.0732519584,213.299095438],[.00036661728,0,0],[.00015274496,4.06493179167,206.1855484372]]],[[[.04330678039,3.60284428399,213.299095438],[.00240348302,2.85238489373,426.598190876],[.00084745939,0,0],[.00030863357,3.48441504555,220.4126424388],[.00034116062,.57297307557,206.1855484372],[.0001473407,2.11846596715,639.897286314],[9916667e-11,5.79003188904,419.4846438752],[6993564e-11,4.7360468972,7.1135470008],[4807588e-11,5.43305312061,316.3918696566]],[[.00198927992,4.93901017903,213.299095438],[.00036947916,3.14159265359,0],[.00017966989,.5197943111,426.598190876]]],[[[9.55758135486,0,0],[.52921382865,2.39226219573,213.299095438],[.01873679867,5.2354960466,206.1855484372],[.01464663929,1.64763042902,426.598190876],[.00821891141,5.93520042303,316.3918696566],[.00547506923,5.0153261898,103.0927742186],[.0037168465,2.27114821115,220.4126424388],[.00361778765,3.13904301847,7.1135470008],[.00140617506,5.70406606781,632.7837393132],[.00108974848,3.29313390175,110.2063212194],[.00069006962,5.94099540992,419.4846438752],[.00061053367,.94037691801,639.897286314],[.00048913294,1.55733638681,202.2533951741],[.00034143772,.19519102597,277.0349937414],[.00032401773,5.47084567016,949.1756089698],[.00020936596,.46349251129,735.8765135318],[9796004e-11,5.20477537945,1265.5674786264],[.00011993338,5.98050967385,846.0828347512],[208393e-9,1.52102476129,433.7117378768],[.00015298404,3.0594381494,529.6909650946],[6465823e-11,.17732249942,1052.2683831884],[.00011380257,1.7310542704,522.5774180938],[3419618e-11,4.94550542171,1581.959348283]],[[.0618298134,.2584351148,213.299095438],[.00506577242,.71114625261,206.1855484372],[.00341394029,5.79635741658,426.598190876],[.00188491195,.47215589652,220.4126424388],[.00186261486,3.14159265359,0],[.00143891146,1.40744822888,7.1135470008]],[[.00436902572,4.78671677509,213.299095438]]]],Uranus:[[[[5.48129294297,0,0],[.09260408234,.89106421507,74.7815985673],[.01504247898,3.6271926092,1.4844727083],[.00365981674,1.89962179044,73.297125859],[.00272328168,3.35823706307,149.5631971346],[.00070328461,5.39254450063,63.7358983034],[.00068892678,6.09292483287,76.2660712756],[.00061998615,2.26952066061,2.9689454166],[.00061950719,2.85098872691,11.0457002639],[.0002646877,3.14152083966,71.8126531507],[.00025710476,6.11379840493,454.9093665273],[.0002107885,4.36059339067,148.0787244263],[.00017818647,1.74436930289,36.6485629295],[.00014613507,4.73732166022,3.9321532631],[.00011162509,5.8268179635,224.3447957019],[.0001099791,.48865004018,138.5174968707],[9527478e-11,2.95516862826,35.1640902212],[7545601e-11,5.236265824,109.9456887885],[4220241e-11,3.23328220918,70.8494453042],[40519e-9,2.277550173,151.0476698429],[3354596e-11,1.0654900738,4.4534181249],[2926718e-11,4.62903718891,9.5612275556],[349034e-10,5.48306144511,146.594251718],[3144069e-11,4.75199570434,77.7505439839],[2922333e-11,5.35235361027,85.8272988312],[2272788e-11,4.36600400036,70.3281804424],[2051219e-11,1.51773566586,.1118745846],[2148602e-11,.60745949945,38.1330356378],[1991643e-11,4.92437588682,277.0349937414],[1376226e-11,2.04283539351,65.2203710117],[1666902e-11,3.62744066769,380.12776796],[1284107e-11,3.11347961505,202.2533951741],[1150429e-11,.93343589092,3.1813937377],[1533221e-11,2.58594681212,52.6901980395],[1281604e-11,.54271272721,222.8603229936],[1372139e-11,4.19641530878,111.4301614968],[1221029e-11,.1990065003,108.4612160802],[946181e-11,1.19253165736,127.4717966068],[1150989e-11,4.17898916639,33.6796175129]],[[74.7815986091,0,0],[.00154332863,5.24158770553,74.7815985673],[.00024456474,1.71260334156,1.4844727083],[9258442e-11,.4282973235,11.0457002639],[8265977e-11,1.50218091379,63.7358983034],[915016e-10,1.41213765216,149.5631971346]]],[[[.01346277648,2.61877810547,74.7815985673],[623414e-9,5.08111189648,149.5631971346],[.00061601196,3.14159265359,0],[9963722e-11,1.61603805646,76.2660712756],[992616e-10,.57630380333,73.297125859]],[[.00034101978,.01321929936,74.7815985673]]],[[[19.21264847206,0,0],[.88784984413,5.60377527014,74.7815985673],[.03440836062,.32836099706,73.297125859],[.0205565386,1.7829515933,149.5631971346],[.0064932241,4.52247285911,76.2660712756],[.00602247865,3.86003823674,63.7358983034],[.00496404167,1.40139935333,454.9093665273],[.00338525369,1.58002770318,138.5174968707],[.00243509114,1.57086606044,71.8126531507],[.00190522303,1.99809394714,1.4844727083],[.00161858838,2.79137786799,148.0787244263],[.00143706183,1.38368544947,11.0457002639],[.00093192405,.17437220467,36.6485629295],[.00071424548,4.24509236074,224.3447957019],[.00089806014,3.66105364565,109.9456887885],[.00039009723,1.66971401684,70.8494453042],[.00046677296,1.39976401694,35.1640902212],[.00039025624,3.36234773834,277.0349937414],[.00036755274,3.88649278513,146.594251718],[.00030348723,.70100838798,151.0476698429],[.00029156413,3.180563367,77.7505439839],[.00022637073,.72518687029,529.6909650946],[.00011959076,1.7504339214,984.6003316219],[.00025620756,5.25656086672,380.12776796]],[[.01479896629,3.67205697578,74.7815985673]]]],Neptune:[[[[5.31188633046,0,0],[.0179847553,2.9010127389,38.1330356378],[.01019727652,.48580922867,1.4844727083],[.00124531845,4.83008090676,36.6485629295],[.00042064466,5.41054993053,2.9689454166],[.00037714584,6.09221808686,35.1640902212],[.00033784738,1.24488874087,76.2660712756],[.00016482741,7727998e-11,491.5579294568],[9198584e-11,4.93747051954,39.6175083461],[899425e-10,.27462171806,175.1660598002]],[[38.13303563957,0,0],[.00016604172,4.86323329249,1.4844727083],[.00015744045,2.27887427527,38.1330356378]]],[[[.03088622933,1.44104372644,38.1330356378],[.00027780087,5.91271884599,76.2660712756],[.00027623609,0,0],[.00015355489,2.52123799551,36.6485629295],[.00015448133,3.50877079215,39.6175083461]]],[[[30.07013205828,0,0],[.27062259632,1.32999459377,38.1330356378],[.01691764014,3.25186135653,36.6485629295],[.00807830553,5.18592878704,1.4844727083],[.0053776051,4.52113935896,35.1640902212],[.00495725141,1.5710564165,491.5579294568],[.00274571975,1.84552258866,175.1660598002],[.0001201232,1.92059384991,1021.2488945514],[.00121801746,5.79754470298,76.2660712756],[.00100896068,.3770272493,73.297125859],[.00135134092,3.37220609835,39.6175083461],[7571796e-11,1.07149207335,388.4651552382]]]]};function En(e){var t,n,r,i,o,s,u;const a=2e3+(e-14)/dn;return a<-500?(t=(a-1820)/100,-20+32*t*t):a<500?(t=a/100,n=t*t,r=t*n,i=n*n,o=n*r,s=r*r,10583.6-1014.41*t+33.78311*n-5.952053*r-.1798452*i+.022174192*o+.0090316521*s):a<1600?(t=(a-1e3)/100,n=t*t,r=t*n,i=n*n,o=n*r,s=r*r,1574.2-556.01*t+71.23472*n+.319781*r-.8503463*i-.005050998*o+.0083572073*s):a<1700?(t=a-1600,n=t*t,r=t*n,120-.9808*t-.01532*n+r/7129):a<1800?(t=a-1700,n=t*t,r=t*n,i=n*n,8.83+.1603*t-.0059285*n+13336e-8*r-i/1174e3):a<1860?(t=a-1800,n=t*t,r=t*n,i=n*n,o=n*r,s=r*r,u=r*i,13.72-.332447*t+.0068612*n+.0041116*r-37436e-8*i+121272e-10*o-1699e-10*s+875e-12*u):a<1900?(t=a-1860,n=t*t,r=t*n,i=n*n,o=n*r,7.62+.5737*t-.251754*n+.01680668*r-.0004473624*i+o/233174):a<1920?(t=a-1900,n=t*t,r=t*n,i=n*n,-2.79+1.494119*t-.0598939*n+.0061966*r-197e-6*i):a<1941?(t=a-1920,n=t*t,r=t*n,21.2+.84493*t-.0761*n+.0020936*r):a<1961?(t=a-1950,n=t*t,r=t*n,29.07+.407*t-n/233+r/2547):a<1986?(t=a-1975,n=t*t,r=t*n,45.45+1.067*t-n/260-r/718):a<2005?(t=a-2e3,n=t*t,r=t*n,i=n*n,o=n*r,63.86+.3345*t-.060374*n+.0017275*r+651814e-9*i+2373599e-11*o):a<2050?(t=a-2e3,62.92+.32217*t+.005589*t*t):a<2150?(t=(a-1820)/100,-20+32*t*t-.5628*(2150-a)):(t=(a-1820)/100,-20+32*t*t)}let Rn=En;function pt(e){return e+Rn(e)/86400}class W{constructor(t){if(t instanceof W){this.date=t.date,this.ut=t.ut,this.tt=t.tt;return}const n=1e3*3600*24;if(t instanceof Date&&Number.isFinite(t.getTime())){this.date=t,this.ut=(t.getTime()-Tt.getTime())/n,this.tt=pt(this.ut);return}if(Number.isFinite(t)){this.date=new Date(Tt.getTime()+t*n),this.ut=t,this.tt=pt(this.ut);return}throw"Argument must be a Date object, an AstroTime object, or a numeric UTC Julian date."}static FromTerrestrialTime(t){let n=new W(t);for(;;){const r=t-n.tt;if(Math.abs(r)<1e-12)return n;n=n.AddDays(r)}}toString(){return this.date.toISOString()}AddDays(t){return new W(this.ut+t)}}function Z(e){return e instanceof W?e:new W(e)}function Sn(e){function t(f){return f%mn*Q}const n=e.tt/36525,r=t(128710479305e-5+n*1295965810481e-4),i=t(335779.526232+n*17395272628478e-4),o=t(107226070369e-5+n*1602961601209e-3),s=t(450160.398036-n*69628905431e-4);let u=Math.sin(s),a=Math.cos(s),d=(-172064161-174666*n)*u+33386*a,_=(92052331+9086*n)*a+15377*u,m=2*(i-o+s);return u=Math.sin(m),a=Math.cos(m),d+=(-13170906-1675*n)*u-13696*a,_+=(5730336-3015*n)*a-4587*u,m=2*(i+s),u=Math.sin(m),a=Math.cos(m),d+=(-2276413-234*n)*u+2796*a,_+=(978459-485*n)*a+1374*u,m=2*s,u=Math.sin(m),a=Math.cos(m),d+=(2074554+207*n)*u-698*a,_+=(-897492+470*n)*a-291*u,u=Math.sin(r),a=Math.cos(r),d+=(1475877-3633*n)*u+11817*a,_+=(73871-184*n)*a-1924*u,{dpsi:-135e-6+d*1e-7,deps:388e-6+_*1e-7}}function Ut(e){var t=e.tt/36525,n=((((-434e-10*t-576e-9)*t+.0020034)*t-1831e-7)*t-46.836769)*t+84381.406;return n/3600}var A0;function Gt(e){if(!A0||Math.abs(A0.tt-e.tt)>1e-6){const t=Sn(e),n=Ut(e),r=n+t.deps/3600;A0={tt:e.tt,dpsi:t.dpsi,deps:t.deps,ee:t.dpsi*Math.cos(n*i0)/15,mobl:n,tobl:r}}return A0}function xn(e,t){const n=e*i0,r=Math.cos(n),i=Math.sin(n);return[t[0],t[1]*r-t[2]*i,t[1]*i+t[2]*r]}function An(e,t){return xn(Ut(e),t)}function Cn(e){const t=e.tt/36525;function n(p,R){const A=[];let w;for(w=0;w<=R-p;++w)A.push(0);return{min:p,array:A}}function r(p,R,A,w){const M=[];for(let k=0;k<=R-p;++k)M.push(n(A,w));return{min:p,array:M}}function i(p,R,A){const w=p.array[R-p.min];return w.array[A-w.min]}function o(p,R,A,w){const M=p.array[R-p.min];M.array[A-M.min]=w}let s,u,a,d,_,m,f,T,h,v,S,C,N,D,P,G,L,O,v0,a0,Y,g0,s0,ft=r(-6,6,1,4),ht=r(-6,6,1,4);function T0(p,R){return i(ft,p,R)}function p0(p,R){return i(ht,p,R)}function E0(p,R,A){return o(ft,p,R,A)}function R0(p,R,A){return o(ht,p,R,A)}function vt(p,R,A,w,M){M(p*A-R*w,R*A+p*w)}function x(p){return Math.sin(F*p)}f=t*t,h=0,s0=0,S=0,C=3422.7;var S0=x(.19833+.05611*t),F0=x(.27869+.04508*t),H0=x(.16827-.36903*t),V0=x(.34734-5.37261*t),k0=x(.10498-5.37899*t),x0=x(.42681-.41855*t),Zt=x(.14943-5.37511*t);for(O=.84*S0+.31*F0+14.27*H0+7.26*V0+.28*k0+.24*x0,v0=2.94*S0+.31*F0+14.27*H0+9.34*V0+1.12*k0+.83*x0,a0=-6.4*S0-1.89*x0,Y=.21*S0+.31*F0+14.27*H0-88.7*V0-15.3*k0+.24*x0-1.86*Zt,g0=O-a0,T=-3332e-9*x(.59734-5.37261*t)-539e-9*x(.35498-5.37899*t)-64e-9*x(.39943-5.37511*t),N=F*J(.60643382+1336.85522467*t-313e-8*f)+O/$,D=F*J(.37489701+1325.55240982*t+2565e-8*f)+v0/$,P=F*J(.99312619+99.99735956*t-44e-8*f)+a0/$,G=F*J(.25909118+1342.2278298*t-892e-8*f)+Y/$,L=F*J(.82736186+1236.85308708*t-397e-8*f)+g0/$,_=1;_<=4;++_){switch(_){case 1:a=D,u=4,d=1.000002208;break;case 2:a=P,u=3,d=.997504612-.002495388*t;break;case 3:a=G,u=4,d=1.000002708+139.978*T;break;case 4:a=L,u=6,d=1;break;default:throw`Internal error: I = ${_}`}for(E0(0,_,1),E0(1,_,Math.cos(a)*d),R0(0,_,0),R0(1,_,Math.sin(a)*d),m=2;m<=u;++m)vt(T0(m-1,_),p0(m-1,_),T0(1,_),p0(1,_),(p,R)=>(E0(m,_,p),R0(m,_,R)));for(m=1;m<=u;++m)E0(-m,_,T0(m,_)),R0(-m,_,-p0(m,_))}function gt(p,R,A,w){for(var M={x:1,y:0},k=[0,p,R,A,w],z=1;z<=4;++z)k[z]!==0&&vt(M.x,M.y,T0(k[z],z),p0(k[z],z),($0,K)=>(M.x=$0,M.y=K));return M}function l(p,R,A,w,M,k,z,$0){var K=gt(M,k,z,$0);h+=p*K.y,s0+=R*K.y,S+=A*K.x,C+=w*K.x}l(13.902,14.06,-.001,.2607,0,0,0,4),l(.403,-4.01,.394,.0023,0,0,0,3),l(2369.912,2373.36,.601,28.2333,0,0,0,2),l(-125.154,-112.79,-.725,-.9781,0,0,0,1),l(1.979,6.98,-.445,.0433,1,0,0,4),l(191.953,192.72,.029,3.0861,1,0,0,2),l(-8.466,-13.51,.455,-.1093,1,0,0,1),l(22639.5,22609.07,.079,186.5398,1,0,0,0),l(18.609,3.59,-.094,.0118,1,0,0,-1),l(-4586.465,-4578.13,-.077,34.3117,1,0,0,-2),l(3.215,5.44,.192,-.0386,1,0,0,-3),l(-38.428,-38.64,.001,.6008,1,0,0,-4),l(-.393,-1.43,-.092,.0086,1,0,0,-6),l(-.289,-1.59,.123,-.0053,0,1,0,4),l(-24.42,-25.1,.04,-.3,0,1,0,2),l(18.023,17.93,.007,.1494,0,1,0,1),l(-668.146,-126.98,-1.302,-.3997,0,1,0,0),l(.56,.32,-.001,-.0037,0,1,0,-1),l(-165.145,-165.06,.054,1.9178,0,1,0,-2),l(-1.877,-6.46,-.416,.0339,0,1,0,-4),l(.213,1.02,-.074,.0054,2,0,0,4),l(14.387,14.78,-.017,.2833,2,0,0,2),l(-.586,-1.2,.054,-.01,2,0,0,1),l(769.016,767.96,.107,10.1657,2,0,0,0),l(1.75,2.01,-.018,.0155,2,0,0,-1),l(-211.656,-152.53,5.679,-.3039,2,0,0,-2),l(1.225,.91,-.03,-.0088,2,0,0,-3),l(-30.773,-34.07,-.308,.3722,2,0,0,-4),l(-.57,-1.4,-.074,.0109,2,0,0,-6),l(-2.921,-11.75,.787,-.0484,1,1,0,2),l(1.267,1.52,-.022,.0164,1,1,0,1),l(-109.673,-115.18,.461,-.949,1,1,0,0),l(-205.962,-182.36,2.056,1.4437,1,1,0,-2),l(.233,.36,.012,-.0025,1,1,0,-3),l(-4.391,-9.66,-.471,.0673,1,1,0,-4),l(.283,1.53,-.111,.006,1,-1,0,4),l(14.577,31.7,-1.54,.2302,1,-1,0,2),l(147.687,138.76,.679,1.1528,1,-1,0,0),l(-1.089,.55,.021,0,1,-1,0,-1),l(28.475,23.59,-.443,-.2257,1,-1,0,-2),l(-.276,-.38,-.006,-.0036,1,-1,0,-3),l(.636,2.27,.146,-.0102,1,-1,0,-4),l(-.189,-1.68,.131,-.0028,0,2,0,2),l(-7.486,-.66,-.037,-.0086,0,2,0,0),l(-8.096,-16.35,-.74,.0918,0,2,0,-2),l(-5.741,-.04,0,-9e-4,0,0,2,2),l(.255,0,0,0,0,0,2,1),l(-411.608,-.2,0,-.0124,0,0,2,0),l(.584,.84,0,.0071,0,0,2,-1),l(-55.173,-52.14,0,-.1052,0,0,2,-2),l(.254,.25,0,-.0017,0,0,2,-3),l(.025,-1.67,0,.0031,0,0,2,-4),l(1.06,2.96,-.166,.0243,3,0,0,2),l(36.124,50.64,-1.3,.6215,3,0,0,0),l(-13.193,-16.4,.258,-.1187,3,0,0,-2),l(-1.187,-.74,.042,.0074,3,0,0,-4),l(-.293,-.31,-.002,.0046,3,0,0,-6),l(-.29,-1.45,.116,-.0051,2,1,0,2),l(-7.649,-10.56,.259,-.1038,2,1,0,0),l(-8.627,-7.59,.078,-.0192,2,1,0,-2),l(-2.74,-2.54,.022,.0324,2,1,0,-4),l(1.181,3.32,-.212,.0213,2,-1,0,2),l(9.703,11.67,-.151,.1268,2,-1,0,0),l(-.352,-.37,.001,-.0028,2,-1,0,-1),l(-2.494,-1.17,-.003,-.0017,2,-1,0,-2),l(.36,.2,-.012,-.0043,2,-1,0,-4),l(-1.167,-1.25,.008,-.0106,1,2,0,0),l(-7.412,-6.12,.117,.0484,1,2,0,-2),l(-.311,-.65,-.032,.0044,1,2,0,-4),l(.757,1.82,-.105,.0112,1,-2,0,2),l(2.58,2.32,.027,.0196,1,-2,0,0),l(2.533,2.4,-.014,-.0212,1,-2,0,-2),l(-.344,-.57,-.025,.0036,0,3,0,-2),l(-.992,-.02,0,0,1,0,2,2),l(-45.099,-.02,0,-.001,1,0,2,0),l(-.179,-9.52,0,-.0833,1,0,2,-2),l(-.301,-.33,0,.0014,1,0,2,-4),l(-6.382,-3.37,0,-.0481,1,0,-2,2),l(39.528,85.13,0,-.7136,1,0,-2,0),l(9.366,.71,0,-.0112,1,0,-2,-2),l(.202,.02,0,0,1,0,-2,-4),l(.415,.1,0,.0013,0,1,2,0),l(-2.152,-2.26,0,-.0066,0,1,2,-2),l(-1.44,-1.3,0,.0014,0,1,-2,2),l(.384,-.04,0,0,0,1,-2,-2),l(1.938,3.6,-.145,.0401,4,0,0,0),l(-.952,-1.58,.052,-.013,4,0,0,-2),l(-.551,-.94,.032,-.0097,3,1,0,0),l(-.482,-.57,.005,-.0045,3,1,0,-2),l(.681,.96,-.026,.0115,3,-1,0,0),l(-.297,-.27,.002,-9e-4,2,2,0,-2),l(.254,.21,-.003,0,2,-2,0,-2),l(-.25,-.22,.004,.0014,1,3,0,-2),l(-3.996,0,0,4e-4,2,0,2,0),l(.557,-.75,0,-.009,2,0,2,-2),l(-.459,-.38,0,-.0053,2,0,-2,2),l(-1.298,.74,0,4e-4,2,0,-2,0),l(.538,1.14,0,-.0141,2,0,-2,-2),l(.263,.02,0,0,1,1,2,0),l(.426,.07,0,-6e-4,1,1,-2,-2),l(-.304,.03,0,3e-4,1,-1,2,0),l(-.372,-.19,0,-.0027,1,-1,-2,2),l(.418,0,0,0,0,0,4,0),l(-.33,-.04,0,0,3,0,2,0);function b(p,R,A,w,M){return p*gt(R,A,w,M).y}v=0,v+=b(-526.069,0,0,1,-2),v+=b(-3.352,0,0,1,-4),v+=b(44.297,1,0,1,-2),v+=b(-6,1,0,1,-4),v+=b(20.599,-1,0,1,0),v+=b(-30.598,-1,0,1,-2),v+=b(-24.649,-2,0,1,0),v+=b(-2,-2,0,1,-2),v+=b(-22.571,0,1,1,-2),v+=b(10.985,0,-1,1,-2),h+=.82*x(.7736-62.5512*t)+.31*x(.0466-125.1025*t)+.35*x(.5785-25.1042*t)+.66*x(.4591+1335.8075*t)+.64*x(.313-91.568*t)+1.14*x(.148+1331.2898*t)+.21*x(.5918+1056.5859*t)+.44*x(.5784+1322.8595*t)+.24*x(.2275-5.7374*t)+.28*x(.2965+2.6929*t)+.33*x(.3132+6.3368*t),s=G+s0/$;let Yt=(1.000002708+139.978*T)*(18518.511+1.189+S)*Math.sin(s)-6.24*Math.sin(3*s)+v;return{geo_eclip_lon:F*J((N+h/$)/F),geo_eclip_lat:Math.PI/(180*3600)*Yt,distance_au:$*hn/(.999953253*C)}}function wn(e,t){return[e.rot[0][0]*t[0]+e.rot[1][0]*t[1]+e.rot[2][0]*t[2],e.rot[0][1]*t[0]+e.rot[1][1]*t[1]+e.rot[2][1]*t[2],e.rot[0][2]*t[0]+e.rot[1][2]*t[1]+e.rot[2][2]*t[2]]}function Mn(e,t,n){const r=Ot(t,n);return wn(r,e)}function Ot(e,t){const n=e.tt/36525;let r=84381.406,i=((((-951e-10*n+132851e-9)*n-.00114045)*n-1.0790069)*n+5038.481507)*n,o=((((3337e-10*n-467e-9)*n-.00772503)*n+.0512623)*n-.025754)*n+r,s=((((-56e-9*n+170663e-9)*n-.00121197)*n-2.3814292)*n+10.556403)*n;r*=Q,i*=Q,o*=Q,s*=Q;const u=Math.sin(r),a=Math.cos(r),d=Math.sin(-i),_=Math.cos(-i),m=Math.sin(-o),f=Math.cos(-o),T=Math.sin(s),h=Math.cos(s),v=h*_-d*T*f,S=h*d*a+T*f*_*a-u*T*m,C=h*d*u+T*f*_*u+a*T*m,N=-T*_-d*h*f,D=-T*d*a+h*f*_*a-u*h*m,P=-T*d*u+h*f*_*u+a*h*m,G=d*m,L=-m*_*a-u*f,O=-m*_*u+f*a;if(t===V.Into2000)return new o0([[v,S,C],[N,D,P],[G,L,O]]);if(t===V.From2000)return new o0([[v,N,G],[S,D,L],[C,P,O]]);throw"Invalid precess direction"}function yn(e){const t=.779057273264+.00273781191135448*e.ut,n=e.ut%1;let r=360*((t+n)%1);return r<0&&(r+=360),r}let C0;function In(e){if(!C0||C0.tt!==e.tt){const t=e.tt/36525;let n=15*Gt(e).ee;const r=yn(e);let o=((n+.014506+((((-368e-10*t-29956e-9)*t-44e-8)*t+1.3915817)*t+4612.156534)*t)/3600+r)%360/15;o<0&&(o+=24),C0={tt:e.tt,st:o}}return C0.st}function Nn(e){const t=Z(e);return In(t)}function Dn(e,t){const n=Gt(e),r=n.mobl*i0,i=n.tobl*i0,o=n.dpsi*Q,s=Math.cos(r),u=Math.sin(r),a=Math.cos(i),d=Math.sin(i),_=Math.cos(o),m=Math.sin(o),f=_,T=-m*s,h=-m*u,v=m*a,S=_*s*a+u*d,C=_*u*a-s*d,N=m*d,D=_*s*d-u*a,P=_*u*d+s*a;if(t===V.From2000)return new o0([[f,v,N],[T,S,D],[h,C,P]]);if(t===V.Into2000)return new o0([[f,T,h],[v,S,C],[N,D,P]]);throw"Invalid precess direction"}class U{constructor(t,n,r,i){this.x=t,this.y=n,this.z=r,this.t=i}Length(){return Math.hypot(this.x,this.y,this.z)}}class Pn{constructor(t,n,r,i,o,s,u){this.x=t,this.y=n,this.z=r,this.vx=i,this.vy=o,this.vz=s,this.t=u}}class Un{constructor(t,n,r){this.lat=X0(t),this.lon=X0(n),this.dist=X0(r)}}class o0{constructor(t){this.rot=t}}function nt(e){const t=Z(e),n=Cn(t),r=n.distance_au*Math.cos(n.geo_eclip_lat),i=[r*Math.cos(n.geo_eclip_lon),r*Math.sin(n.geo_eclip_lon),n.distance_au*Math.sin(n.geo_eclip_lat)],o=An(t,i),s=Mn(o,t,V.Into2000);return new U(s[0],s[1],s[2],t)}function e0(e,t,n){let r=1,i=0;for(let o of e){let s=0;for(let[a,d,_]of o)s+=a*Math.cos(d+t*_);let u=r*s;n&&(u%=F),i+=u,r*=t}return i}function q0(e,t){let n=1,r=0,i=0,o=0;for(let s of e){let u=0,a=0;for(let[d,_,m]of s){let f=_+t*m;u+=d*m*Math.sin(f),o>0&&(a+=d*Math.cos(f))}i+=o*r*a-n*u,r=n,n*=t,++o}return i}const u0=365250,et=0,rt=1,it=2;function ot(e){return new I(e[0]+44036e-11*e[1]-190919e-12*e[2],-479966e-12*e[0]+.917482137087*e[1]-.397776982902*e[2],.397776982902*e[1]+.917482137087*e[2])}function bt(e,t,n){const r=n*Math.cos(t),i=Math.cos(e),o=Math.sin(e);return[r*i,r*o,n*Math.sin(t)]}function I0(e,t){const n=t.tt/u0,r=e0(e[et],n,!0),i=e0(e[rt],n,!1),o=e0(e[it],n,!1),s=bt(r,i,o);return ot(s).ToAstroVector(t)}function Gn(e,t){const n=t/u0,r=e0(e[et],n,!0),i=e0(e[rt],n,!1),o=e0(e[it],n,!1),s=q0(e[et],n),u=q0(e[rt],n),a=q0(e[it],n),d=Math.cos(r),_=Math.sin(r),m=Math.cos(i),f=Math.sin(i),T=+(a*m*d)-o*f*d*u-o*m*_*s,h=+(a*m*_)-o*f*_*u+o*m*d*s,v=+(a*f)+o*m*u,S=bt(r,i,o),C=[T/u0,h/u0,v/u0],N=ot(S),D=ot(C);return new B(t,N,D)}function w0(e,t,n,r){const i=r/(r+dt),o=I0(t0[n],t);e.x+=i*o.x,e.y+=i*o.y,e.z+=i*o.z}function On(e){const t=new U(0,0,0,e);return w0(t,e,E.Jupiter,K0),w0(t,e,E.Saturn,J0),w0(t,e,E.Uranus,Q0),w0(t,e,E.Neptune,tt),t}const at=51,bn=29200,n0=146,H=201,q=[[-73e4,[-26.118207232108,-14.376168177825,3.384402515299],[.0016339372163656,-.0027861699588508,-.0013585880229445]],[-700800,[41.974905202127,-.448502952929,-12.770351505989],[.00073458569351457,.0022785014891658,.00048619778602049]],[-671600,[14.706930780744,44.269110540027,9.353698474772],[-.00210001479998,.00022295915939915,.00070143443551414]],[-642400,[-29.441003929957,-6.43016153057,6.858481011305],[.00084495803960544,-.0030783914758711,-.0012106305981192]],[-613200,[39.444396946234,-6.557989760571,-13.913760296463],[.0011480029005873,.0022400006880665,.00035168075922288]],[-584e3,[20.2303809507,43.266966657189,7.382966091923],[-.0019754081700585,.00053457141292226,.00075929169129793]],[-554800,[-30.65832536462,2.093818874552,9.880531138071],[61010603013347e-18,-.0031326500935382,-.00099346125151067]],[-525600,[35.737703251673,-12.587706024764,-14.677847247563],[.0015802939375649,.0021347678412429,.00019074436384343]],[-496400,[25.466295188546,41.367478338417,5.216476873382],[-.0018054401046468,.0008328308359951,.00080260156912107]],[-467200,[-29.847174904071,10.636426313081,12.297904180106],[-.00063257063052907,-.0029969577578221,-.00074476074151596]],[-438e3,[30.774692107687,-18.236637015304,-14.945535879896],[.0020113162005465,.0019353827024189,-20937793168297e-19]],[-408800,[30.243153324028,38.656267888503,2.938501750218],[-.0016052508674468,.0011183495337525,.00083333973416824]],[-379600,[-27.288984772533,18.643162147874,14.023633623329],[-.0011856388898191,-.0027170609282181,-.00049015526126399]],[-350400,[24.519605196774,-23.245756064727,-14.626862367368],[.0024322321483154,.0016062008146048,-.00023369181613312]],[-321200,[34.505274805875,35.125338586954,.557361475637],[-.0013824391637782,.0013833397561817,.00084823598806262]],[-292e3,[-23.275363915119,25.818514298769,15.055381588598],[-.0016062295460975,-.0023395961498533,-.00024377362639479]],[-262800,[17.050384798092,-27.180376290126,-13.608963321694],[.0028175521080578,.0011358749093955,-.00049548725258825]],[-233600,[38.093671910285,30.880588383337,-1.843688067413],[-.0011317697153459,.0016128814698472,.00084177586176055]],[-204400,[-18.197852930878,31.932869934309,15.438294826279],[-.0019117272501813,-.0019146495909842,-19657304369835e-18]],[-175200,[8.528924039997,-29.618422200048,-11.805400994258],[.0031034370787005,.0005139363329243,-.00077293066202546]],[-146e3,[40.94685725864,25.904973592021,-4.256336240499],[-.00083652705194051,.0018129497136404,.0008156422827306]],[-116800,[-12.326958895325,36.881883446292,15.217158258711],[-.0021166103705038,-.001481442003599,.00017401209844705]],[-87600,[-.633258375909,-30.018759794709,-9.17193287495],[.0032016994581737,-.00025279858672148,-.0010411088271861]],[-58400,[42.936048423883,20.344685584452,-6.588027007912],[-.00050525450073192,.0019910074335507,.00077440196540269]],[-29200,[-5.975910552974,40.61180995846,14.470131723673],[-.0022184202156107,-.0010562361130164,.00033652250216211]],[0,[-9.875369580774,-27.978926224737,-5.753711824704],[.0030287533248818,-.0011276087003636,-.0012651326732361]],[29200,[43.958831986165,14.214147973292,-8.808306227163],[-.00014717608981871,.0021404187242141,.00071486567806614]],[58400,[.67813676352,43.094461639362,13.243238780721],[-.0022358226110718,-.00063233636090933,.00047664798895648]],[87600,[-18.282602096834,-23.30503958666,-1.766620508028],[.0025567245263557,-.0019902940754171,-.0013943491701082]],[116800,[43.873338744526,7.700705617215,-10.814273666425],[.00023174803055677,.0022402163127924,.00062988756452032]],[146e3,[7.392949027906,44.382678951534,11.629500214854],[-.002193281545383,-.00021751799585364,.00059556516201114]],[175200,[-24.981690229261,-16.204012851426,2.466457544298],[.001819398914958,-.0026765419531201,-.0013848283502247]],[204400,[42.530187039511,.845935508021,-12.554907527683],[.00065059779150669,.0022725657282262,.00051133743202822]],[233600,[13.999526486822,44.462363044894,9.669418486465],[-.0021079296569252,.00017533423831993,.00069128485798076]],[262800,[-29.184024803031,-7.371243995762,6.493275957928],[.00093581363109681,-.0030610357109184,-.0012364201089345]],[292e3,[39.831980671753,-6.078405766765,-13.909815358656],[.0011117769689167,.0022362097830152,.00036230548231153]],[321200,[20.294955108476,43.417190420251,7.450091985932],[-.0019742157451535,.00053102050468554,.00075938408813008]],[350400,[-30.66999230216,2.318743558955,9.973480913858],[45605107450676e-18,-.0031308219926928,-.00099066533301924]],[379600,[35.626122155983,-12.897647509224,-14.777586508444],[.0016015684949743,.0021171931182284,.00018002516202204]],[408800,[26.133186148561,41.232139187599,5.00640132622],[-.0017857704419579,.00086046232702817,.00080614690298954]],[438e3,[-29.57674022923,11.863535943587,12.631323039872],[-.00072292830060955,-.0029587820140709,-.000708242964503]],[467200,[29.910805787391,-19.159019294,-15.013363865194],[.0020871080437997,.0018848372554514,-38528655083926e-18]],[496400,[31.375957451819,38.050372720763,2.433138343754],[-.0015546055556611,.0011699815465629,.00083565439266001]],[525600,[-26.360071336928,20.662505904952,14.414696258958],[-.0013142373118349,-.0026236647854842,-.00042542017598193]],[554800,[22.599441488648,-24.508879898306,-14.484045731468],[.0025454108304806,.0014917058755191,-.00030243665086079]],[584e3,[35.877864013014,33.894226366071,-.224524636277],[-.0012941245730845,.0014560427668319,.00084762160640137]],[613200,[-21.538149762417,28.204068269761,15.321973799534],[-.001731211740901,-.0021939631314577,-.0001631691327518]],[642400,[13.971521374415,-28.339941764789,-13.083792871886],[.0029334630526035,.00091860931752944,-.00059939422488627]],[671600,[39.526942044143,28.93989736011,-2.872799527539],[-.0010068481658095,.001702113288809,.00083578230511981]],[700800,[-15.576200701394,34.399412961275,15.466033737854],[-.0020098814612884,-.0017191109825989,70414782780416e-18]],[73e4,[4.24325283709,-30.118201690825,-10.707441231349],[.0031725847067411,.0001609846120227,-.00090672150593868]]];class I{constructor(t,n,r){this.x=t,this.y=n,this.z=r}clone(){return new I(this.x,this.y,this.z)}ToAstroVector(t){return new U(this.x,this.y,this.z,t)}static zero(){return new I(0,0,0)}quadrature(){return this.x*this.x+this.y*this.y+this.z*this.z}add(t){return new I(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new I(this.x-t.x,this.y-t.y,this.z-t.z)}incr(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}decr(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}mul(t){return new I(t*this.x,t*this.y,t*this.z)}div(t){return new I(this.x/t,this.y/t,this.z/t)}mean(t){return new I((this.x+t.x)/2,(this.y+t.y)/2,(this.z+t.z)/2)}neg(){return new I(-this.x,-this.y,-this.z)}}class B{constructor(t,n,r){this.tt=t,this.r=n,this.v=r}clone(){return new B(this.tt,this.r,this.v)}sub(t){return new B(this.tt,this.r.sub(t.r),this.v.sub(t.v))}}function Ln(e){let[t,[n,r,i],[o,s,u]]=e;return new B(t,new I(n,r,i),new I(o,s,u))}function M0(e,t,n,r){const i=r/(r+dt),o=Gn(t0[n],t);return e.r.incr(o.r.mul(i)),e.v.incr(o.v.mul(i)),o}function c0(e,t,n){const r=n.sub(e),i=r.quadrature();return r.mul(t/(i*Math.sqrt(i)))}class _t{constructor(t){let n=new B(t,new I(0,0,0),new I(0,0,0));this.Jupiter=M0(n,t,E.Jupiter,K0),this.Saturn=M0(n,t,E.Saturn,J0),this.Uranus=M0(n,t,E.Uranus,Q0),this.Neptune=M0(n,t,E.Neptune,tt),this.Jupiter.r.decr(n.r),this.Jupiter.v.decr(n.v),this.Saturn.r.decr(n.r),this.Saturn.v.decr(n.v),this.Uranus.r.decr(n.r),this.Uranus.v.decr(n.v),this.Neptune.r.decr(n.r),this.Neptune.v.decr(n.v),this.Sun=new B(t,n.r.mul(-1),n.v.mul(-1))}Acceleration(t){let n=c0(t,dt,this.Sun.r);return n.incr(c0(t,K0,this.Jupiter.r)),n.incr(c0(t,J0,this.Saturn.r)),n.incr(c0(t,Q0,this.Uranus.r)),n.incr(c0(t,tt,this.Neptune.r)),n}}class z0{constructor(t,n,r,i){this.tt=t,this.r=n,this.v=r,this.a=i}clone(){return new z0(this.tt,this.r.clone(),this.v.clone(),this.a.clone())}}class Lt{constructor(t,n){this.bary=t,this.grav=n}}function N0(e,t,n,r){return new I(t.x+e*(n.x+e*r.x/2),t.y+e*(n.y+e*r.y/2),t.z+e*(n.z+e*r.z/2))}function Et(e,t,n){return new I(t.x+e*n.x,t.y+e*n.y,t.z+e*n.z)}function st(e,t){const n=e-t.tt,r=new _t(e),i=N0(n,t.r,t.v,t.a),o=r.Acceleration(i).mean(t.a),s=N0(n,t.r,t.v,o),u=t.v.add(o.mul(n)),a=r.Acceleration(s),d=new z0(e,s,u,a);return new Lt(r,d)}const zn=[];function zt(e,t){const n=Math.floor(e);return n<0?0:n>=t?t-1:n}function ct(e){const t=Ln(e),n=new _t(t.tt),r=t.r.add(n.Sun.r),i=t.v.add(n.Sun.v),o=n.Acceleration(r),s=new z0(t.tt,r,i,o);return new Lt(n,s)}function Fn(e,t){const n=q[0][0];if(t<n||t>q[at-1][0])return null;const r=zt((t-n)/bn,at-1);if(!e[r]){const o=e[r]=[];o[0]=ct(q[r]).grav,o[H-1]=ct(q[r+1]).grav;let s,u=o[0].tt;for(s=1;s<H-1;++s)o[s]=st(u+=n0,o[s-1]).grav;u=o[H-1].tt;var i=[];for(i[H-1]=o[H-1],s=H-2;s>0;--s)i[s]=st(u-=n0,i[s+1]).grav;for(s=H-2;s>0;--s){const a=s/(H-1);o[s].r=o[s].r.mul(1-a).add(i[s].r.mul(a)),o[s].v=o[s].v.mul(1-a).add(i[s].v.mul(a)),o[s].a=o[s].a.mul(1-a).add(i[s].a.mul(a))}}return e[r]}function Rt(e,t,n){let r=ct(e);const i=Math.ceil((t-r.grav.tt)/n);for(let o=0;o<i;++o)r=st(o+1===i?t:r.grav.tt+n,r.grav);return r}function Hn(e,t){let n,r,i;const o=Fn(zn,e.tt);if(o){const s=zt((e.tt-o[0].tt)/n0,H-1),u=o[s],a=o[s+1],d=u.a.mean(a.a),_=N0(e.tt-u.tt,u.r,u.v,d),m=Et(e.tt-u.tt,u.v,d),f=N0(e.tt-a.tt,a.r,a.v,d),T=Et(e.tt-a.tt,a.v,d),h=(e.tt-u.tt)/n0;n=_.mul(1-h).add(f.mul(h)),r=m.mul(1-h).add(T.mul(h))}else{let s;e.tt<q[0][0]?s=Rt(q[0],e.tt,-n0):s=Rt(q[at-1],e.tt,+n0),n=s.grav.r,r=s.grav.v,i=s.bary}return i||(i=new _t(e.tt)),n=n.sub(i.Sun.r),r=r.sub(i.Sun.v),new Pn(n.x,n.y,n.z,r.x,r.y,r.z,e)}function l0(e,t){var n=Z(t);if(e in t0)return I0(t0[e],n);if(e===E.Pluto){const s=Hn(n);return new U(s.x,s.y,s.z,n)}if(e===E.Sun)return new U(0,0,0,n);if(e===E.Moon){var r=I0(t0.Earth,n),i=nt(n);return new U(r.x+i.x,r.y+i.y,r.z+i.z,n)}if(e===E.EMB){const s=I0(t0.Earth,n),u=nt(n),a=1+vn;return new U(s.x+u.x/a,s.y+u.y/a,s.z+u.z/a,n)}if(e===E.SSB)return On(n);const o=Pt(e);if(o){const s=new Un(o.dec,15*o.ra,o.dist);return Xn(s,n)}throw`HelioVector: Unknown body "${e}"`}function Vn(e,t){let n=t,r=0;for(let i=0;i<10;++i){const o=e(n),s=o.Length()/un;if(s>1)throw"Object is too distant for light-travel solver.";const u=t.AddDays(-s);if(r=Math.abs(u.tt-n.tt),r<1e-9)return o;n=u}throw`Light-travel time solver did not converge: dt = ${r}`}class kn{constructor(t,n,r,i){this.observerBody=t,this.targetBody=n,this.aberration=r,this.observerPos=i}Position(t){this.aberration&&(this.observerPos=l0(this.observerBody,t));const n=l0(this.targetBody,t);return new U(n.x-this.observerPos.x,n.y-this.observerPos.y,n.z-this.observerPos.z,t)}}function $n(e,t,n,r){const i=Z(e);if(Pt(n)){const u=l0(n,i),a=l0(t,i);return new U(u.x-a.x,u.y-a.y,u.z-a.z,i)}let o;o=l0(t,i);const s=new kn(t,n,r,o);return Vn(u=>s.Position(u),i)}function Wn(e,t,n){const r=Z(t);switch(e){case E.Earth:return new U(0,0,0,r);case E.Moon:return nt(r);default:const i=$n(r,E.Earth,e,n);return i.t=r,i}}var St;(function(e){e[e.Pericenter=0]="Pericenter",e[e.Apocenter=1]="Apocenter"})(St||(St={}));function Ft(e,t){return new o0([[t.rot[0][0]*e.rot[0][0]+t.rot[1][0]*e.rot[0][1]+t.rot[2][0]*e.rot[0][2],t.rot[0][1]*e.rot[0][0]+t.rot[1][1]*e.rot[0][1]+t.rot[2][1]*e.rot[0][2],t.rot[0][2]*e.rot[0][0]+t.rot[1][2]*e.rot[0][1]+t.rot[2][2]*e.rot[0][2]],[t.rot[0][0]*e.rot[1][0]+t.rot[1][0]*e.rot[1][1]+t.rot[2][0]*e.rot[1][2],t.rot[0][1]*e.rot[1][0]+t.rot[1][1]*e.rot[1][1]+t.rot[2][1]*e.rot[1][2],t.rot[0][2]*e.rot[1][0]+t.rot[1][2]*e.rot[1][1]+t.rot[2][2]*e.rot[1][2]],[t.rot[0][0]*e.rot[2][0]+t.rot[1][0]*e.rot[2][1]+t.rot[2][0]*e.rot[2][2],t.rot[0][1]*e.rot[2][0]+t.rot[1][1]*e.rot[2][1]+t.rot[2][1]*e.rot[2][2],t.rot[0][2]*e.rot[2][0]+t.rot[1][2]*e.rot[2][1]+t.rot[2][2]*e.rot[2][2]]])}function Xn(e,t){t=Z(t);const n=e.lat*i0,r=e.lon*i0,i=e.dist*Math.cos(n);return new U(i*Math.cos(r),i*Math.sin(r),e.dist*Math.sin(n),t)}function qn(e){e=Z(e);const t=Ot(e,V.From2000),n=Dn(e,V.From2000);return Ft(t,n)}var xt;(function(e){e.Penumbral="penumbral",e.Partial="partial",e.Annular="annular",e.Total="total"})(xt||(xt={}));var At;(function(e){e[e.Invalid=0]="Invalid",e[e.Ascending=1]="Ascending",e[e.Descending=-1]="Descending"})(At||(At={}));const jn=new c.Matrix4;function Bn(e){const t=Math.cos(e),n=Math.sin(e);return new o0([[t,-n,0],[n,t,0],[0,0,1]])}function h0(e){return e instanceof W?e:new W(e instanceof Date?e:new Date(e))}function Ht(e,t=new c.Matrix4){const n=h0(e),r=qn(n),i=Bn(Nn(n)*(-Math.PI/12)),{rot:o}=Ft(r,i);return t.set(o[0][0],o[0][1],o[0][2],0,o[1][0],o[1][1],o[1][2],0,o[2][0],o[2][1],o[2][2],0,0,0,0,1)}function mt(e,t,n){const{x:r,y:i,z:o}=Wn(e,t,!1);return n.set(r,i,o).normalize()}function Vt(e,t,n){const r=Ht(t,jn);return mt(e,t,n).applyMatrix4(r)}function Zn(e,t=new c.Vector3){return mt(E.Sun,h0(e),t)}function Yn(e,t=new c.Vector3){return mt(E.Moon,h0(e),t)}function Kn(e,t=new c.Vector3){return Vt(E.Sun,h0(e),t)}function Jn(e,t=new c.Vector3){return Vt(E.Moon,h0(e),t)}function kt(e){return Math.sqrt(Math.max(e,0))}function Qn(e){return Math.max(e,0)}function te(e,t,n){const{bottomRadius:r}=e;return n<0&&t*t*(n*n-1)+r*r>=0}function ne(e,t,n){const{topRadius:r}=e,i=t*t*(n*n-1)+r*r;return Qn(-t*n+kt(i))}function D0(e,t){return .5/t+e*(1-1/t)}var ee=process.env.NODE_ENV==="production",Ct="Invariant failed";function re(e,t){if(!e){if(ee)throw new Error(Ct);var n=Ct;throw new Error(n)}}const ie=new c.Vector3,wt=new c.Vector3,oe=new c.Vector3;function y0(e,t,n){const r=t*4;return n.set(e[r],e[r+1],e[r+2])}function $t(e,t,n){const{data:r,width:i,height:o}=e.image;re(r instanceof Float32Array);const s=y.clamp(t.x,0,1)*(i-1),u=y.clamp(t.y,0,1)*(o-1),a=Math.floor(s),d=Math.floor(u),_=s-a,m=u-d,f=_,T=m,h=a%i,v=(h+1)%i,S=d%o,C=(S+1)%o,N=y0(r,S*i+h,ie),D=y0(r,S*i+v,wt),P=N.lerp(D,f),G=y0(r,C*i+h,wt),L=y0(r,C*i+v,oe),O=G.lerp(L,f);return n.copy(P.lerp(O,T))}function ae(e,t,n,r){const{topRadius:i,bottomRadius:o}=e,s=Math.sqrt(i*i-o*o),u=kt(t*t-o*o),a=ne(e,t,n),d=i-t,_=u+s,m=(a-d)/(_-d),f=u/s;return r.set(D0(m,m0),D0(f,f0))}const se=new c.Vector3,j0=new c.Vector3,ce=new c.Vector2;function Wt(e,t,n,r=new c.Color,{ellipsoid:i=y.Ellipsoid.WGS84,correctAltitude:o=!0,photometric:s=!0}={},u=X.DEFAULT){const a=se.copy(t);if(o){const v=i.projectOnSurface(t,j0);v!=null&&a.sub(i.getOsculatingSphereCenter(v,u.bottomRadius,j0))}const d=j0;let _=a.length(),m=a.dot(n);const{topRadius:f}=u,T=-m-Math.sqrt(m*m-_*_+f*f);if(T>0&&(_=f,m+=T),_>f)d.set(1,1,1);else{const v=m/_;if(te(u,_,v))d.set(0,0,0);else{const C=ae(u,_,v,ce);$t(e,C,d)}}const h=d.multiply(u.solarIrradiance);return s&&h.multiply(u.sunRadianceToRelativeLuminance),r.setFromVector3(h)}function ue(e){var t=[];if(e.length===0)return"";if(typeof e[0]!="string")throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var n=e.shift();e[0]=n+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var r=0;r<e.length;r++){var i=e[r];if(typeof i!="string")throw new TypeError("Url must be a string. Received "+i);i!==""&&(r>0&&(i=i.replace(/^[\/]+/,"")),r<e.length-1?i=i.replace(/[\/]+$/,""):i=i.replace(/[\/]+$/,"/"),t.push(i))}var o=t.join("/");o=o.replace(/\/(\?|&|#[^!])/g,"$1");var s=o.split("?");return o=s.shift()+(s.length>0?"?":"")+s.join("&"),o}function le(){var e;return typeof arguments[0]=="object"?e=arguments[0]:e=[].slice.call(arguments),ue(e)}class de extends c.Loader{constructor(){super(...arguments);g(this,"useHalfFloat",!1)}load(n,r,i,o){const s={},u=(a,{Loader:d,width:_,height:m,depth:f,suffix:T=""})=>{const h=new d(this.manager);h.setRequestHeader(this.requestHeader),h.setPath(this.path),h.setWithCredentials(this.withCredentials),h.load(le(n,`${a}${T}.bin`),v=>{v.image.width=_,v.image.height=m,v instanceof c.Data3DTexture&&f!=null&&(v.image.depth=f),this.useHalfFloat&&(v.internalFormat="RGBA16F"),s[`${a}Texture`]=v,s.irradianceTexture!=null&&s.scatteringTexture!=null&&s.transmittanceTexture!=null&&r(s)},i,o)};u("irradiance",{Loader:y.Float32Data2DLoader,width:d0,height:_0}),u("scattering",{Loader:y.Float32Data3DLoader,width:Mt,height:yt,depth:It,suffix:this.useHalfFloat?"":"_float"}),u("transmittance",{Loader:y.Float32Data2DLoader,width:m0,height:f0})}}function _e({topRadius:e,bottomRadius:t},n,r,i){const o=(n-t)/(e-t),s=r*.5+.5;return i.set(D0(s,d0),D0(o,_0))}const me=1/Math.sqrt(Math.PI),B0=Math.sqrt(3)/(2*Math.sqrt(Math.PI)),fe=new c.Vector3,Z0=new c.Vector3,he=new c.Vector2,Xt={ellipsoid:y.Ellipsoid.WGS84,correctAltitude:!0,photometric:!0};class ve extends c.LightProbe{constructor(n,r=X.DEFAULT){super();g(this,"atmosphere");g(this,"irradianceTexture");g(this,"ellipsoid");g(this,"correctAltitude");g(this,"photometric");g(this,"sunDirection");const{irradianceTexture:i=null,ellipsoid:o,correctAltitude:s,photometric:u,sunDirection:a}={...Xt,...n};this.atmosphere=r,this.irradianceTexture=i,this.ellipsoid=o,this.correctAltitude=s,this.photometric=u,this.sunDirection=(a==null?void 0:a.clone())??new c.Vector3}update(){if(this.irradianceTexture==null)return;const n=this.getWorldPosition(fe);if(this.correctAltitude){const d=this.ellipsoid.projectOnSurface(n,Z0);d!=null&&n.sub(this.ellipsoid.getOsculatingSphereCenter(d,this.atmosphere.bottomRadius,Z0))}const r=n.length(),i=n.dot(this.sunDirection)/r,o=_e(this.atmosphere,r,i,he),s=$t(this.irradianceTexture,o,Z0);this.photometric&&s.multiply(this.atmosphere.skyRadianceToRelativeLuminance);const u=this.ellipsoid.getSurfaceNormal(n),a=this.sh.coefficients;a[0].copy(s).multiplyScalar(me),a[1].copy(s).multiplyScalar(B0*u.y),a[2].copy(s).multiplyScalar(B0*u.z),a[3].copy(s).multiplyScalar(B0*u.x)}}var ge=`uniform vec3 sunDirection;
uniform vec3 moonDirection;
uniform float moonAngularRadius;
uniform float lunarRadianceScale;

in vec3 vWorldPosition;
in vec3 vWorldDirection;
in vec3 vEllipsoidCenter;

layout(location = 0) out vec4 outputColor;

#include <mrt_layout>

void main() {
  vec3 viewPosition = vWorldPosition - vEllipsoidCenter;
  vec3 rayDirection = normalize(vWorldDirection);

  outputColor.rgb = getSkyRadiance(
    viewPosition,
    rayDirection,
    sunDirection,
    moonDirection,
    moonAngularRadius,
    lunarRadianceScale
  );
  outputColor.a = 1.0;

  #include <mrt_output>
}`,Te=`uniform mat4 inverseProjectionMatrix;
uniform mat4 inverseViewMatrix;
uniform vec3 cameraPosition;
uniform vec3 ellipsoidCenter;

layout(location = 0) in vec3 position;

out vec3 vWorldPosition;
out vec3 vWorldDirection;
out vec3 vEllipsoidCenter;

void getCameraRay(out vec3 origin, out vec3 direction) {
  bool isPerspective = inverseProjectionMatrix[2][3] != 0.0; 

  if (isPerspective) {
    
    vec4 viewPosition = inverseProjectionMatrix * vec4(position, 1.0);
    vec4 worldDirection = inverseViewMatrix * vec4(viewPosition.xyz, 0.0);
    origin = cameraPosition;
    direction = worldDirection.xyz;
  } else {
    
    vec4 nearPoint = inverseProjectionMatrix * vec4(position.xy, -1.0, 1.0);
    vec4 farPoint = inverseProjectionMatrix * vec4(position.xy, -0.9, 1.0);
    nearPoint /= nearPoint.w;
    farPoint /= farPoint.w;

    
    vec4 worldDirection =
      inverseViewMatrix * vec4(farPoint.xyz - nearPoint.xyz, 0.0);
    vec4 worldOrigin = inverseViewMatrix * nearPoint;

    
    direction = worldDirection.xyz;
    origin = worldOrigin.xyz;
  }
}

void main() {
  vec3 direction, origin;
  getCameraRay(origin, direction);

  vWorldPosition = origin.xyz * METER_TO_UNIT_LENGTH;
  vWorldDirection = direction.xyz;
  vEllipsoidCenter = ellipsoidCenter * METER_TO_UNIT_LENGTH;

  gl_Position = vec4(position.xy, 1.0, 1.0);
}`;const qt={...L0,sun:!0,moon:!0,moonAngularRadius:.0045,lunarRadianceScale:1};class pe extends lt{constructor(t){const{sun:n,moon:r,moonDirection:i,moonAngularRadius:o,lunarRadianceScale:s,...u}={...qt,...t};super({glslVersion:c.GLSL3,vertexShader:`
        precision highp float;
        precision highp sampler3D;
        ${r0}
        ${Te}
      `,fragmentShader:`
        precision highp float;
        precision highp sampler3D;
        ${r0}
        ${ut}
        ${Nt}
        ${ge}
      `,...u,uniforms:{inverseProjectionMatrix:new c.Uniform(new c.Matrix4),inverseViewMatrix:new c.Uniform(new c.Matrix4),moonDirection:new c.Uniform((i==null?void 0:i.clone())??new c.Vector3),moonAngularRadius:new c.Uniform(o),lunarRadianceScale:new c.Uniform(s),...u.uniforms},defines:{PERSPECTIVE_CAMERA:"1"},depthTest:!0}),this.sun=n,this.moon=r}onBeforeRender(t,n,r,i,o,s){super.onBeforeRender(t,n,r,i,o,s);const u=this.uniforms;u.inverseProjectionMatrix.value.copy(r.projectionMatrixInverse),u.inverseViewMatrix.value.copy(r.matrixWorld);const a=r.isPerspectiveCamera===!0;this.defines.PERSPECTIVE_CAMERA!=null!==a&&(a?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}get sun(){return this.defines.SUN!=null}set sun(t){t!==this.sun&&(t?this.defines.SUN="1":delete this.defines.SUN,this.needsUpdate=!0)}get moon(){return this.defines.MOON!=null}set moon(t){t!==this.moon&&(t?this.defines.MOON="1":delete this.defines.MOON,this.needsUpdate=!0)}get moonDirection(){return this.uniforms.moonDirection.value}get moonAngularRadius(){return this.uniforms.moonAngularRadius.value}set moonAngularRadius(t){this.uniforms.moonAngularRadius.value=t}get lunarRadianceScale(){return this.uniforms.lunarRadianceScale.value}set lunarRadianceScale(t){this.uniforms.lunarRadianceScale.value=t}}class Ee extends c.BufferGeometry{constructor(t){super();const n=new Int16Array(t),r=new Uint8Array(t),i=new c.InterleavedBuffer(n,5),o=new c.InterleavedBuffer(r,10);this.setAttribute("position",new c.InterleavedBufferAttribute(i,3,0,!0)),this.setAttribute("magnitude",new c.InterleavedBufferAttribute(o,1,6,!0)),this.setAttribute("color",new c.InterleavedBufferAttribute(o,3,7,!0)),this.boundingSphere=new c.Sphere(new c.Vector3,1)}}var Re=`uniform vec3 sunDirection;

in vec3 vWorldPosition;
in vec3 vWorldDirection;
in vec3 vEllipsoidCenter;

layout(location = 0) out vec4 outputColor;

#include <mrt_layout>

in vec3 vColor;

void main() {
  #ifndef PERSPECTIVE_CAMERA
  outputColor = vec4(0.0);
  discard; 
  #endif

  #ifdef BACKGROUND
  vec3 viewDirection = normalize(vWorldDirection);
  vec3 transmittance;
  vec3 radiance = GetSkyRadiance(
    vWorldPosition - vEllipsoidCenter,
    viewDirection,
    0.0,
    sunDirection,
    transmittance
  );
  radiance += transmittance * vColor;
  outputColor = vec4(radiance, 1.0);
  #else
  outputColor = vec4(vColor, 1.0);
  #endif 

  #include <mrt_output>
}`,Se=`#define saturate(x) clamp(x, 0.0, 1.0)

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform mat4 viewMatrix;
uniform mat4 matrixWorld;
uniform vec3 cameraPosition;
uniform float cameraFar;
uniform vec3 ellipsoidCenter;
uniform float pointSize;
uniform vec2 magnitudeRange;
uniform float radianceScale;

layout(location = 0) in vec3 position;
layout(location = 1) in float magnitude;
layout(location = 2) in vec3 color;

out vec3 vWorldPosition;
out vec3 vWorldDirection;
out vec3 vEllipsoidCenter;
out vec3 vColor;

void main() {
  
  float m = mix(magnitudeRange.x, magnitudeRange.y, magnitude);
  vec3 v = pow(vec3(10.0), -vec3(magnitudeRange, m) / 2.5);
  vColor = vec3(radianceScale * color);
  vColor *= saturate((v.z - v.y) / (v.x - v.y));

  #ifdef BACKGROUND
  vec3 worldDirection = normalize(matrixWorld * vec4(position, 1.0)).xyz;
  vWorldDirection = worldDirection;
  vWorldPosition = cameraPosition * METER_TO_UNIT_LENGTH;
  vEllipsoidCenter = ellipsoidCenter * METER_TO_UNIT_LENGTH;
  gl_Position =
    projectionMatrix *
    viewMatrix *
    vec4(cameraPosition + worldDirection * cameraFar, 1.0);
  #else
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  #endif 

  gl_PointSize = pointSize;
}`;const jt={...L0,pointSize:1,radianceScale:1,background:!0};class xe extends lt{constructor(n){const{pointSize:r,radianceScale:i,background:o,...s}={...jt,...n};super({glslVersion:c.GLSL3,vertexShader:`
        precision highp float;
        precision highp sampler3D;
        ${r0}
        ${Se}
      `,fragmentShader:`
        precision highp float;
        precision highp sampler3D;
        ${r0}
        ${ut}
        ${Re}
      `,...s,uniforms:{projectionMatrix:new c.Uniform(new c.Matrix4),modelViewMatrix:new c.Uniform(new c.Matrix4),viewMatrix:new c.Uniform(new c.Matrix4),matrixWorld:new c.Uniform(new c.Matrix4),cameraFar:new c.Uniform(0),pointSize:new c.Uniform(0),magnitudeRange:new c.Uniform(new c.Vector2(-2,8)),radianceScale:new c.Uniform(i),...s.uniforms},defines:{PERSPECTIVE_CAMERA:"1"}});g(this,"pointSize");this.pointSize=r,this.background=o}onBeforeRender(n,r,i,o,s,u){super.onBeforeRender(n,r,i,o,s,u);const a=this.uniforms;a.projectionMatrix.value.copy(i.projectionMatrix),a.modelViewMatrix.value.copy(i.modelViewMatrix),a.viewMatrix.value.copy(i.matrixWorldInverse),a.matrixWorld.value.copy(s.matrixWorld),a.cameraFar.value=i.far,a.pointSize.value=this.pointSize*n.getPixelRatio();const d=i.isPerspectiveCamera===!0;this.defines.PERSPECTIVE_CAMERA!=null!==d&&(d?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}get magnitudeRange(){return this.uniforms.magnitudeScale.value}get radianceScale(){return this.uniforms.radianceScale.value}set radianceScale(n){this.uniforms.radianceScale.value=n}get background(){return this.defines.BACKGROUND!=null}set background(n){n!==this.background&&(n?this.defines.BACKGROUND="1":delete this.defines.BACKGROUND,this.needsUpdate=!0)}}const Ae=new c.Vector3,Bt={ellipsoid:y.Ellipsoid.WGS84,correctAltitude:!0,photometric:!0,distance:1};class Ce extends c.DirectionalLight{constructor(n,r=X.DEFAULT){super();g(this,"atmosphere");g(this,"transmittanceTexture");g(this,"ellipsoid");g(this,"correctAltitude");g(this,"photometric");g(this,"sunDirection");g(this,"distance");const{irradianceTexture:i=null,ellipsoid:o,correctAltitude:s,photometric:u,sunDirection:a,distance:d}={...Bt,...n};this.atmosphere=r,this.transmittanceTexture=i,this.ellipsoid=o,this.correctAltitude=s,this.photometric=u,this.sunDirection=(a==null?void 0:a.clone())??new c.Vector3,this.distance=d}update(){this.position.copy(this.sunDirection).normalize().multiplyScalar(this.distance).add(this.target.position),this.transmittanceTexture!=null&&Wt(this.transmittanceTexture,this.target.getWorldPosition(Ae),this.sunDirection,this.color,{ellipsoid:this.ellipsoid,correctAltitude:this.correctAltitude,photometric:this.photometric},this.atmosphere)}}exports.AerialPerspectiveEffect=an;exports.AtmosphereMaterialBase=lt;exports.AtmosphereParameters=X;exports.IRRADIANCE_TEXTURE_HEIGHT=_0;exports.IRRADIANCE_TEXTURE_WIDTH=d0;exports.METER_TO_UNIT_LENGTH=j;exports.PrecomputedTexturesLoader=de;exports.SCATTERING_TEXTURE_DEPTH=It;exports.SCATTERING_TEXTURE_HEIGHT=yt;exports.SCATTERING_TEXTURE_MU_SIZE=G0;exports.SCATTERING_TEXTURE_MU_S_SIZE=O0;exports.SCATTERING_TEXTURE_NU_SIZE=b0;exports.SCATTERING_TEXTURE_R_SIZE=U0;exports.SCATTERING_TEXTURE_WIDTH=Mt;exports.SKY_RENDER_ORDER=nn;exports.SkyLightProbe=ve;exports.SkyMaterial=pe;exports.StarsGeometry=Ee;exports.StarsMaterial=xe;exports.SunDirectionalLight=Ce;exports.TRANSMITTANCE_TEXTURE_HEIGHT=f0;exports.TRANSMITTANCE_TEXTURE_WIDTH=m0;exports.aerialPerspectiveEffectOptionsDefaults=Dt;exports.atmosphereMaterialParametersBaseDefaults=L0;exports.getECIToECEFRotationMatrix=Ht;exports.getMoonDirectionECEF=Jn;exports.getMoonDirectionECI=Yn;exports.getSunDirectionECEF=Kn;exports.getSunDirectionECI=Zn;exports.getSunLightColor=Wt;exports.skyLightProbeParametersDefaults=Xt;exports.skyMaterialParametersDefaults=qt;exports.starsMaterialParametersDefaults=jt;exports.sunDirectionalLightParametersDefaults=Bt;
//# sourceMappingURL=shared.cjs.map
